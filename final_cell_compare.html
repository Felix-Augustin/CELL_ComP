<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å° - æœ€ç»ˆå®Œæ•´ç‰ˆ v5.0</title>
    
    <!-- Three.js æ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    
    <!-- OBJå’ŒMTLåŠ è½½å™¨ - ç”¨äºåŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/MTLLoader.js"></script>
    
    <!-- BioDigital API - ç”¨äºçœŸæ ¸ç»†èƒä¸“ä¸šæ¨¡å‹ -->
    <script src="https://developer.biodigital.com/builds/api/human-api-3.0.0.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #09375C, #3DA4E6, #95D4F3);
        }
        
        /* å¼€åœºè§†é¢‘å®¹å™¨ */
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #09375C, #2B313F);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #platform-title {
            position: absolute;
            color: #F9F2E0;
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.5s ease;
            z-index: 1001;
        }
        
        #platform-title.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        #enter-button {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 40px;
            font-size: 18px;
            background: rgba(249, 242, 224, 0.15);
            color: #F9F2E0;
            border: 2px solid rgba(249, 242, 224, 0.3);
            border-radius: 15px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            z-index: 1001;
        }
        
        #enter-button.show {
            opacity: 1;
        }
        
        #enter-button:hover {
            background: rgba(249, 242, 224, 0.25);
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 8px 25px rgba(249, 242, 224, 0.2);
        }
        
        /* ä¸»åº”ç”¨å®¹å™¨ */
        #main-container {
            display: none;
            width: 100vw;
            height: 100vh;
            flex-direction: row;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        #control-panel {
            width: 300px;
            padding: 20px;
            background: linear-gradient(135deg, #F9F2E0, #F7ECE7);
            box-shadow: 0 0 20px rgba(9, 55, 92, 0.2);
            overflow-y: auto;
            border-right: 2px solid rgba(9, 55, 92, 0.1);
        }
        
        /* å±•ç¤ºåŒºåŸŸå®¹å™¨ - åˆ†ä¸ºå·¦å³ä¸¤å— */
        #display-container {
            flex: 1;
            display: flex;
            flex-direction: row;
            background: #f0f0f0;
        }
        
        /* åŸæ ¸ç»†èƒå±•ç¤ºåŒºåŸŸï¼ˆå·¦ä¾§ï¼‰ */
        #prokaryotic-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #95D4F3, #3DA4E6, #09375C);
            border-right: 2px solid rgba(9, 55, 92, 0.3);
        }
        
        /* çœŸæ ¸ç»†èƒå±•ç¤ºåŒºåŸŸï¼ˆå³ä¾§ï¼‰ */
        #eukaryotic-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #C6E6E8, #95D4F3, #3DA4E6);
        }
        
        /* åŒºåŸŸæ ‡é¢˜ */
        .area-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(9, 55, 92, 0.9);
            color: #F9F2E0;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(249, 242, 224, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* BioDigitalåµŒå…¥å¼å®¹å™¨ - ç°åœ¨å¡«æ»¡å³ä¾§åŒºåŸŸ */
        #biodigital-eukaryotic-cell {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            overflow: hidden;
            background: transparent;
            z-index: 5;
        }
        
        #biodigital-cell-widget {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
        }
        
        .biodigital-overlay {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(9, 55, 92, 0.9);
            color: #F9F2E0;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(249, 242, 224, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* ä¿¡æ¯é¢æ¿æ ·å¼ */
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            border-left: 4px solid #1660AB;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .info-panel {
            background: rgba(9, 55, 92, 0.1);
            border: 1px solid rgba(249, 242, 224, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .info-panel p {
            margin: 5px 0;
            color: #2B313F;
            font-size: 14px;
            line-height: 1.4;
        }
        
        /* é«˜äº®æŒ‰é’®æ ·å¼ */
        .highlight-btn {
            display: inline-block;
            margin: 5px 5px 5px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #1660AB, #3DA4E6);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .highlight-btn:hover {
            background: linear-gradient(135deg, #3DA4E6, #95D4F3);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .highlight-btn.active {
            background: linear-gradient(135deg, #A61B29, #FF4444);
        }
        
        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .control-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            background: linear-gradient(135deg, #1660AB, #3DA4E6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, #3DA4E6, #95D4F3);
            transform: translateY(-1px);
        }
        
        /* åˆ‡æ¢å¼€å…³æ ·å¼ */
        .toggle-switch {
            display: inline-flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .toggle-switch input[type="checkbox"] {
            display: none;
        }
        
        .toggle-slider {
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
            margin-right: 10px;
        }
        
        .toggle-slider:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background: #1660AB;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .loading-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(9, 55, 92, 0.9);
            color: #F9F2E0;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .loading-indicator.show {
            opacity: 1;
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 { 
            color: #A61B29; 
            border-bottom: 3px solid #A61B29; 
            padding-bottom: 10px; 
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        h2 { 
            color: #1660AB; 
            border-bottom: 2px solid #1660AB; 
            padding-bottom: 8px; 
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        h3 { 
            color: #2B313F; 
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-loading { background-color: #FFA500; }
        .status-success { background-color: #4CAF50; }
        .status-error { background-color: #F44336; }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            #control-panel {
                width: 280px;
            }
            
            #biodigital-eukaryotic-cell {
                width: 500px;
                height: 500px;
                right: 60px;
                top: 100px;
            }
        }
        
        @media (max-width: 900px) {
            #control-panel {
                width: 250px;
                padding: 15px;
            }
            
            #biodigital-eukaryotic-cell {
                width: 400px;
                height: 400px;
                right: 40px;
                top: 80px;
            }
            
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.2rem; }
            h3 { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <!-- å¼€åœºè§†é¢‘ -->
    <div id="video-container">
        <video id="intro-video" muted autoplay loop>
            <source src="animation.mp4" type="video/mp4">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
        </video>
        <div id="platform-title">ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°</div>
        <button id="enter-button">ğŸ”¬ è¿›å…¥3Dä¸–ç•Œ</button>
    </div>
    
    <!-- ä¸»åº”ç”¨ -->
    <div id="main-container">
        <!-- æ§åˆ¶é¢æ¿ -->
        <div id="control-panel">
            <h1>ğŸ§¬ ç»†èƒç»“æ„å¯¹æ¯”å¹³å°</h1>
            
            <div class="section">
                <h2>ğŸ“Š æ¨¡å‹çŠ¶æ€</h2>
                <div class="info-panel">
                    <p><span class="status-indicator status-loading" id="prokaryotic-status"></span><strong>åŸæ ¸ç»†èƒ:</strong> <span id="prokaryotic-text">å‡†å¤‡åŠ è½½...</span></p>
                    <p><span class="status-indicator status-loading" id="eukaryotic-status"></span><strong>çœŸæ ¸ç»†èƒ:</strong> <span id="eukaryotic-text">å‡†å¤‡åŠ è½½...</span></p>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ¯ ç‰¹æ€§å¯¹æ¯”</h2>
                <div class="info-panel">
                    <p><strong>å·¦ä¾§ï¼š</strong>åŸæ ¸ç»†èƒ (ä¸“ä¸šOBJæ¨¡å‹)</p>
                    <p><strong>å³ä¾§ï¼š</strong>çœŸæ ¸ç»†èƒ (BioDigital 3Dæ¨¡å‹)</p>
                    <p><strong>æ“ä½œï¼š</strong>é¼ æ ‡æ‹–æ‹½æ—‹è½¬ï¼Œæ»šè½®ç¼©æ”¾</p>
                </div>
                
                <div class="control-group">
                    <button class="control-btn" onclick="resetCamera()">é‡ç½®è§†è§’</button>
                    <button class="control-btn" onclick="toggleFullscreen()">å…¨å±æ¨¡å¼</button>
                </div>
            </div>
            
            <div class="section">
                <h3>ğŸ¦  åŸæ ¸ç»†èƒç‰¹å¾</h3>
                <div class="info-panel">
                    <p>ğŸ§¬ ä½¿ç”¨ cell_model1/cell_model1 ä¸“ä¸šOBJæ¨¡å‹</p>
                    <p>ğŸ“š åŒ…å«ç»†èƒè†œã€ç»†èƒå£ã€æ‹Ÿæ ¸ç­‰å®Œæ•´ç»“æ„</p>
                    <p>ğŸ¨ æ”¯æŒé«˜è´¨é‡çº¹ç†è´´å›¾å’Œæè´¨</p>
                    <p>ğŸ”„ æ™ºèƒ½å¤‡ç”¨æœºåˆ¶ç¡®ä¿æ˜¾ç¤º</p>
                    <p>âš¡ å®æ—¶å…‰ç…§å’Œé˜´å½±æ•ˆæœ</p>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ”¬ åŸæ ¸ç»†èƒç»“æ„é«˜äº®</h4>
                    <button class="highlight-btn" onclick="highlightPart('prokaryotic', 'membrane')">ç»†èƒè†œ</button>
                    <button class="highlight-btn" onclick="highlightPart('prokaryotic', 'cytoplasm')">ç»†èƒè´¨</button>
                    <button class="highlight-btn" onclick="highlightPart('prokaryotic', 'nucleoid')">æ‹Ÿæ ¸</button>
                    <button class="highlight-btn" onclick="highlightPart('prokaryotic', 'ribosomes')">æ ¸ç³–ä½“</button>
                    <button class="highlight-btn" onclick="clearHighlight()">æ¸…é™¤é«˜äº®</button>
                </div>
                
                <div class="toggle-switch">
                    <input type="checkbox" id="prokaryotic-animation" onchange="toggleAnimation('prokaryotic')">
                    <label for="prokaryotic-animation" class="toggle-slider"></label>
                    <span>å¯ç”¨åŠ¨ç”»æ•ˆæœ</span>
                </div>
            </div>
            
            <div class="section">
                <h3>ğŸ”¬ çœŸæ ¸ç»†èƒç‰¹å¾</h3>
                <div class="info-panel">
                    <p>ğŸŒŸ BioDigitalä¸“ä¸šåŒ»å­¦çº§3Dæ¨¡å‹</p>
                    <p>ğŸ¯ ä½¿ç”¨Viewer APIåµŒå…¥å¼æ˜¾ç¤º</p>
                    <p>âœ¨ æ”¯æŒåŸºæœ¬çš„è§†è§’æ§åˆ¶å’Œäº¤äº’</p>
                    <p>ğŸ”„ å¤šæ¨¡å‹æ™ºèƒ½åˆ‡æ¢æœºåˆ¶</p>
                    <p>ï¿½ åŒ»å­¦æ•™è‚²æ ‡å‡†è´¨é‡</p>
                    <p>ï¿½ å®Œå…¨å“åº”å¼è®¾è®¡</p>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ§¬ çœŸæ ¸ç»†èƒç»“æ„èšç„¦</h4>
                    <button class="highlight-btn" onclick="highlightEukaryoticPart('nucleus')">ç»†èƒæ ¸</button>
                    <button class="highlight-btn" onclick="highlightEukaryoticPart('mitochondria')">çº¿ç²’ä½“</button>
                    <button class="highlight-btn" onclick="highlightEukaryoticPart('er')">å†…è´¨ç½‘</button>
                    <button class="highlight-btn" onclick="highlightEukaryoticPart('golgi')">é«˜å°”åŸºä½“</button>
                    <button class="highlight-btn" onclick="clearEukaryoticHighlight()">é‡ç½®è§†å›¾</button>
                </div>
                
                <div class="control-group">
                    <button class="control-btn" onclick="testBioDigitalAPI()">æµ‹è¯•API</button>
                    <button class="control-btn" onclick="resetBioDigitalView()">é‡ç½®è§†å›¾</button>
                    <button class="control-btn" onclick="showModelInfo()">æŸ¥çœ‹ä¿¡æ¯</button>
                </div>
            </div>
            
            <div class="section">
                <h3>ğŸ® äº¤äº’æŒ‡å—</h3>
                <div class="info-panel">
                    <p><strong>ğŸ–±ï¸ é¼ æ ‡å·¦é”®:</strong> æ‹–æ‹½æ—‹è½¬è§†è§’</p>
                    <p><strong>ğŸ”„ é¼ æ ‡æ»šè½®:</strong> ç¼©æ”¾è§†å›¾</p>
                    <p><strong>ğŸ–±ï¸ é¼ æ ‡å³é”®:</strong> å¹³ç§»åœºæ™¯</p>
                    <p><strong>ğŸ“± è§¦æ§è®¾å¤‡:</strong> å•æŒ‡æ—‹è½¬ï¼ŒåŒæŒ‡ç¼©æ”¾</p>
                    <p><strong>âŒ¨ï¸ Ré”®:</strong> é‡ç½®è§†è§’</p>
                    <p><strong>âŒ¨ï¸ Fé”®:</strong> åˆ‡æ¢å…¨å±</p>
                </div>
            </div>
            
            <div class="section">
                <h3>â„¹ï¸ ç³»ç»Ÿä¿¡æ¯</h3>
                <div class="info-panel">
                    <p><strong>ç‰ˆæœ¬:</strong> v5.0 æœ€ç»ˆå®Œæ•´ç‰ˆ</p>
                    <p><strong>æ¸²æŸ“å¼•æ“:</strong> Three.js</p>
                    <p><strong>æ¨¡å‹æ ¼å¼:</strong> OBJ/MTL + BioDigital</p>
                    <p><strong>æ„å»ºæ—¶é—´:</strong> <span id="build-time"></span></p>
                </div>
            </div>
        </div>
        
        <!-- å±•ç¤ºåŒºåŸŸ -->
        <div id="display-container">
            <!-- åŸæ ¸ç»†èƒå±•ç¤ºåŒºåŸŸï¼ˆå·¦ä¾§ï¼‰ -->
            <div id="prokaryotic-container">
                <div class="area-title">ğŸ¦  åŸæ ¸ç»†èƒ (OBJæ¨¡å‹)</div>
                <div class="loading-indicator" id="prokaryotic-loading">
                    æ­£åœ¨åŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹...
                </div>
            </div>
            
            <!-- çœŸæ ¸ç»†èƒå±•ç¤ºåŒºåŸŸï¼ˆå³ä¾§ï¼‰ -->
            <div id="eukaryotic-container">
                <div class="area-title">ğŸ”¬ çœŸæ ¸ç»†èƒ (BioDigital)</div>
                <div class="loading-indicator" id="eukaryotic-loading">
                    æ­£åœ¨åŠ è½½çœŸæ ¸ç»†èƒæ¨¡å‹...
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸš€ ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å° v5.0 æœ€ç»ˆå®Œæ•´ç‰ˆå¯åŠ¨');
        console.log('ğŸ“… æ„å»ºæ—¶é—´:', new Date().toISOString());
        
        // å…¨å±€å˜é‡
        let scene, camera, renderer, controls;
        let biodigitalLoaded = false;
        let prokaryoticLoaded = false;
        
        // BioDigital APIé…ç½® (ä»…ç”¨äºViewer API)
        const BIODIGITAL_API_KEY = '0e068cfbbba1de0aef62cb0f88efc977de83ff6f';
        
        // DOMå…ƒç´ 
        const videoContainer = document.getElementById('video-container');
        const introVideo = document.getElementById('intro-video');
        const platformTitle = document.getElementById('platform-title');
        const enterButton = document.getElementById('enter-button');
        const mainContainer = document.getElementById('main-container');
        
        // çŠ¶æ€æŒ‡ç¤ºå™¨
        const prokaryoticStatus = document.getElementById('prokaryotic-status');
        const prokaryoticText = document.getElementById('prokaryotic-text');
        const eukaryoticStatus = document.getElementById('eukaryotic-status');
        const eukaryoticText = document.getElementById('eukaryotic-text');
        
        // åŠ è½½æŒ‡ç¤ºå™¨
        const prokaryoticLoading = document.getElementById('prokaryotic-loading');
        const eukaryoticLoading = document.getElementById('eukaryotic-loading');
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(type, status, text) {
            const statusEl = type === 'prokaryotic' ? prokaryoticStatus : eukaryoticStatus;
            const textEl = type === 'prokaryotic' ? prokaryoticText : eukaryoticText;
            
            statusEl.className = `status-indicator status-${status}`;
            textEl.textContent = text;
        }
        
        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoading(text) {
            if (prokaryoticLoading) {
                prokaryoticLoading.textContent = text;
                prokaryoticLoading.classList.add('show');
            }
        }
        
        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideLoading() {
            if (prokaryoticLoading) {
                prokaryoticLoading.classList.remove('show');
            }
        }
        
        // æ˜¾ç¤ºçœŸæ ¸ç»†èƒåŠ è½½æŒ‡ç¤ºå™¨
        function showEukaryoticLoading(text) {
            if (eukaryoticLoading) {
                eukaryoticLoading.textContent = text;
                eukaryoticLoading.classList.add('show');
            }
        }
        
        // éšè—çœŸæ ¸ç»†èƒåŠ è½½æŒ‡ç¤ºå™¨
        function hideEukaryoticLoading() {
            if (eukaryoticLoading) {
                eukaryoticLoading.classList.remove('show');
            }
        }
        
        // å¼€åœºè§†é¢‘å¤„ç†
        function initVideoIntro() {
            console.log('ğŸ¬ åˆå§‹åŒ–å¼€åœºè§†é¢‘');
            
            // è§†é¢‘åŠ è½½æˆåŠŸ
            introVideo.addEventListener('loadeddata', function() {
                console.log('âœ… è§†é¢‘åŠ è½½æˆåŠŸ');
                setTimeout(() => {
                    platformTitle.classList.add('show');
                    setTimeout(() => {
                        enterButton.classList.add('show');
                    }, 1000);
                }, 2000);
            });
            
            // è§†é¢‘åŠ è½½å¤±è´¥
            introVideo.addEventListener('error', function() {
                console.log('âš ï¸ è§†é¢‘åŠ è½½å¤±è´¥ï¼Œç›´æ¥æ˜¾ç¤ºè¿›å…¥æŒ‰é’®');
                setTimeout(() => {
                    platformTitle.classList.add('show');
                    enterButton.classList.add('show');
                }, 1000);
            });
            
            // è¶…æ—¶ä¿æŠ¤æœºåˆ¶
            setTimeout(() => {
                if (!enterButton.classList.contains('show')) {
                    console.log('â° è¶…æ—¶ä¿æŠ¤ï¼šå¼ºåˆ¶æ˜¾ç¤ºè¿›å…¥æŒ‰é’®');
                    platformTitle.classList.add('show');
                    enterButton.classList.add('show');
                }
            }, 5000);
        }
        
        // è¿›å…¥ä¸»ç•Œé¢
        function enterMainApp() {
            console.log('ğŸ¯ è¿›å…¥ä¸»åº”ç”¨ç•Œé¢');
            videoContainer.style.opacity = '0';
            setTimeout(() => {
                videoContainer.style.display = 'none';
                mainContainer.style.display = 'flex';
                init3DViewer();
            }, 500);
        }
        
        // åˆå§‹åŒ–3Dåœºæ™¯
        function init3DViewer() {
            console.log('ğŸ® åˆå§‹åŒ–3Dåœºæ™¯');
            showLoading('æ­£åœ¨åˆå§‹åŒ–3Då¼•æ“...');
            
            const container = document.getElementById('prokaryotic-container');
            
            try {
                // åœºæ™¯è®¾ç½®
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x95D4F3);
                scene.fog = new THREE.Fog(0x95D4F3, 50, 200);
                
                // ç›¸æœºè®¾ç½®
                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(0, 15, 35);
                
                // æ¸²æŸ“å™¨è®¾ç½®
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true
                });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(renderer.domElement);
                
                // æ§åˆ¶å™¨è®¾ç½®
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enableZoom = true;
                controls.enableRotate = true;
                controls.enablePan = true;
                controls.autoRotate = false; // ç¦ç”¨è‡ªåŠ¨æ—‹è½¬
                controls.maxDistance = 100;
                controls.minDistance = 10;
                
                // å…‰æºè®¾ç½®
                setupLighting();
                
                // åˆ›å»ºæ¨¡å‹
                createProkaryoticCell();
                createBioDigitalEukaryoticCell();
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                animate();
                
                console.log('âœ… 3Dåœºæ™¯åˆå§‹åŒ–å®Œæˆ');
                hideLoading();
                
            } catch (error) {
                console.error('âŒ 3Dåœºæ™¯åˆå§‹åŒ–å¤±è´¥:', error);
                showLoading('3Dåœºæ™¯åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }
        
        // è®¾ç½®å…‰æº
        function setupLighting() {
            // ç¯å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0xF9F2E0, 0.6);
            scene.add(ambientLight);
            
            // ä¸»å…‰æº
            const directionalLight = new THREE.DirectionalLight(0x3DA4E6, 1.0);
            directionalLight.position.set(15, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // è¡¥å……å…‰æº
            const pointLight = new THREE.PointLight(0xffffff, 0.5, 100);
            pointLight.position.set(-10, 10, 10);
            scene.add(pointLight);
        }
        
        // åˆ›å»ºåŸæ ¸ç»†èƒï¼ˆOBJæ¨¡å‹ï¼‰
        function createProkaryoticCell() {
            console.log('ğŸ§¬ å¼€å§‹åŠ è½½åŸæ ¸ç»†èƒOBJæ¨¡å‹');
            updateStatus('prokaryotic', 'loading', 'æ­£åœ¨åŠ è½½OBJæ¨¡å‹...');
            
            // åˆ›å»ºåŠ è½½å ä½ç¬¦
            const loadingGroup = new THREE.Group();
            const loadingGeometry = new THREE.SphereGeometry(5, 16, 16);
            const loadingMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4ECDC4, 
                transparent: true, 
                opacity: 0.5,
                wireframe: true
            });
            const loadingMesh = new THREE.Mesh(loadingGeometry, loadingMaterial);
            loadingGroup.add(loadingMesh);
            loadingGroup.position.set(-15, 0, 0);
            scene.add(loadingGroup);
            
            // åˆ›å»ºåŠ è½½æ ‡ç­¾
            const loadingLabel = createTextLabel('åŠ è½½ä¸­...', new THREE.Vector3(-15, 12, 0));
            scene.add(loadingLabel);
            
            // å°è¯•åŠ è½½MTLå’ŒOBJ
            loadProkaryoticModel(loadingGroup, loadingLabel);
        }
        
        // åŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹
        function loadProkaryoticModel(loadingGroup, loadingLabel) {
            const mtlLoader = new THREE.MTLLoader();
            mtlLoader.setPath('./cell_model1/cell_model1/');  // ä¿®æ­£è·¯å¾„ï¼šæ·»åŠ åµŒå¥—çš„cell_model1æ–‡ä»¶å¤¹
            
            // é¦–å…ˆå°è¯•å¢å¼ºç‰ˆMTL
            mtlLoader.load('model_enhanced.mtl', 
                function(materials) {
                    console.log('âœ… å¢å¼ºç‰ˆMTLåŠ è½½æˆåŠŸ');
                    updateStatus('prokaryotic', 'loading', 'åŠ è½½OBJæ¨¡å‹...');
                    materials.preload();
                    loadOBJWithMaterials(materials, loadingGroup, loadingLabel);
                },
                function(progress) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    updateStatus('prokaryotic', 'loading', `åŠ è½½æè´¨ ${percent}%`);
                },
                function(error) {
                    console.log('âš ï¸ å¢å¼ºç‰ˆMTLå¤±è´¥ï¼Œå°è¯•åŸå§‹MTL');
                    // å°è¯•åŸå§‹MTL
                    mtlLoader.load('model.mtl',
                        function(materials) {
                            console.log('âœ… åŸå§‹MTLåŠ è½½æˆåŠŸ');
                            materials.preload();
                            loadOBJWithMaterials(materials, loadingGroup, loadingLabel);
                        },
                        undefined,
                        function(error) {
                            console.log('âš ï¸ æ‰€æœ‰MTLå¤±è´¥ï¼ŒåªåŠ è½½OBJ');
                            loadOBJWithoutMTL(loadingGroup, loadingLabel);
                        }
                    );
                }
            );
        }
        
        // ä½¿ç”¨æè´¨åŠ è½½OBJ
        function loadOBJWithMaterials(materials, loadingGroup, loadingLabel) {
            const objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.setPath('./cell_model1/cell_model1/');  // ä¿®æ­£è·¯å¾„ï¼šæ·»åŠ åµŒå¥—çš„cell_model1æ–‡ä»¶å¤¹
            
            objLoader.load('model.obj', 
                function(object) {
                    console.log('âœ… OBJæ¨¡å‹åŠ è½½æˆåŠŸï¼ˆå¸¦æè´¨ï¼‰');
                    updateStatus('prokaryotic', 'success', 'ä¸“ä¸šOBJæ¨¡å‹');
                    processLoadedModel(object, loadingGroup, loadingLabel, 'åŸæ ¸ç»†èƒ (ä¸“ä¸šæ¨¡å‹)');
                    prokaryoticLoaded = true;
                },
                function(progress) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    updateStatus('prokaryotic', 'loading', `åŠ è½½æ¨¡å‹ ${percent}%`);
                },
                function(error) {
                    console.error('âŒ OBJæ¨¡å‹åŠ è½½å¤±è´¥:', error);
                    updateStatus('prokaryotic', 'error', 'åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¨¡å‹');
                    createBackupProkaryoticCell(loadingGroup, loadingLabel);
                }
            );
        }
        
        // åªåŠ è½½OBJï¼ˆæ— æè´¨ï¼‰
        function loadOBJWithoutMTL(loadingGroup, loadingLabel) {
            console.log('ğŸ”„ åŠ è½½OBJæ¨¡å‹ï¼ˆæ— æè´¨ï¼‰');
            updateStatus('prokaryotic', 'loading', 'åŠ è½½OBJï¼ˆæ— æè´¨ï¼‰...');
            
            const objLoader = new THREE.OBJLoader();
            objLoader.setPath('./cell_model1/cell_model1/');  // ä¿®æ­£è·¯å¾„ï¼šæ·»åŠ åµŒå¥—çš„cell_model1æ–‡ä»¶å¤¹
            
            objLoader.load('model.obj',
                function(object) {
                    console.log('âœ… OBJæ¨¡å‹åŠ è½½æˆåŠŸï¼ˆæ— æè´¨ï¼‰');
                    
                    // åº”ç”¨é»˜è®¤æè´¨
                    object.traverse(function(child) {
                        if (child.isMesh) {
                            child.material = new THREE.MeshLambertMaterial({ 
                                color: 0x4ECDC4,
                                transparent: true,
                                opacity: 0.8
                            });
                        }
                    });
                    
                    updateStatus('prokaryotic', 'success', 'OBJæ¨¡å‹ï¼ˆé»˜è®¤æè´¨ï¼‰');
                    processLoadedModel(object, loadingGroup, loadingLabel, 'åŸæ ¸ç»†èƒ (OBJ)');
                    prokaryoticLoaded = true;
                },
                function(progress) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    updateStatus('prokaryotic', 'loading', `åŠ è½½æ¨¡å‹ ${percent}%`);
                },
                function(error) {
                    console.error('âŒ OBJæ¨¡å‹å®Œå…¨åŠ è½½å¤±è´¥:', error);
                    updateStatus('prokaryotic', 'error', 'åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¨¡å‹');
                    createBackupProkaryoticCell(loadingGroup, loadingLabel);
                }
            );
        }
        
        // å¤„ç†åŠ è½½å®Œæˆçš„æ¨¡å‹
        function processLoadedModel(object, loadingGroup, loadingLabel, labelText) {
            // ç§»é™¤å ä½ç¬¦
            scene.remove(loadingGroup);
            scene.remove(loadingLabel);
            
            // é…ç½®æ¨¡å‹ä½ç½®
            object.position.set(-15, 0, 0);
            
            // è®¡ç®—å’Œè°ƒæ•´æ¨¡å‹å¤§å°
            const box = new THREE.Box3().setFromObject(object);
            const size = box.getSize(new THREE.Vector3());
            const maxSize = Math.max(size.x, size.y, size.z);
            
            if (maxSize > 0) {
                const scale = 12 / maxSize;
                object.scale.setScalar(scale);
                
                // å±…ä¸­æ¨¡å‹
                const center = box.getCenter(new THREE.Vector3());
                object.position.set(-15, -center.y * scale, 0);
            }
            
            // å¯ç”¨é˜´å½±
            object.traverse(function(child) {
                if (child.isMesh) {
                    child.castShadow = true;
                    child.receiveShadow = true;
                }
            });
            
            // æ·»åŠ ä¸“ç”¨å…‰æº
            const modelLight = new THREE.PointLight(0xffffff, 0.8, 60);
            modelLight.position.set(-15, 15, 15);
            modelLight.castShadow = true;
            scene.add(modelLight);
            
            // æ·»åŠ åˆ°åœºæ™¯
            scene.add(object);
            
            // æ·»åŠ æ ‡ç­¾
            const label = createTextLabel(labelText, new THREE.Vector3(-15, 15, 0));
            scene.add(label);
            
            console.log('ğŸ¯ åŸæ ¸ç»†èƒæ¨¡å‹é›†æˆå®Œæˆ:', labelText);
        }
        
        // å¤‡ç”¨Three.jsåŸæ ¸ç»†èƒ
        function createBackupProkaryoticCell(loadingGroup, loadingLabel) {
            console.log('ğŸ”„ åˆ›å»ºå¤‡ç”¨Three.jsåŸæ ¸ç»†èƒ');
            updateStatus('prokaryotic', 'error', 'Three.jså¤‡ç”¨æ¨¡å‹');
            
            // ç§»é™¤å ä½ç¬¦
            scene.remove(loadingGroup);
            scene.remove(loadingLabel);
            
            const prokaryoticGroup = new THREE.Group();
            
            // ç»†èƒè†œ
            const cellGeometry = new THREE.SphereGeometry(8, 32, 32);
            const cellMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4ECDC4, 
                transparent: true, 
                opacity: 0.4 
            });
            const cellMembrane = new THREE.Mesh(cellGeometry, cellMaterial);
            cellMembrane.castShadow = true;
            prokaryoticGroup.add(cellMembrane);
            
            // ç»†èƒè´¨
            const cytoplasmGeometry = new THREE.SphereGeometry(7.5, 32, 32);
            const cytoplasmMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x95D4F3, 
                transparent: true, 
                opacity: 0.2 
            });
            const cytoplasm = new THREE.Mesh(cytoplasmGeometry, cytoplasmMaterial);
            prokaryoticGroup.add(cytoplasm);
            
            // æ‹Ÿæ ¸
            const nucleoidGeometry = new THREE.SphereGeometry(3, 16, 16);
            const nucleoidMaterial = new THREE.MeshLambertMaterial({ color: 0x1660AB });
            const nucleoid = new THREE.Mesh(nucleoidGeometry, nucleoidMaterial);
            nucleoid.castShadow = true;
            prokaryoticGroup.add(nucleoid);
            
            // æ ¸ç³–ä½“
            for (let i = 0; i < 20; i++) {
                const ribosomeGeometry = new THREE.SphereGeometry(0.3, 8, 8);
                const ribosomeMaterial = new THREE.MeshLambertMaterial({ color: 0xA61B29 });
                const ribosome = new THREE.Mesh(ribosomeGeometry, ribosomeMaterial);
                
                const angle = (i / 20) * Math.PI * 2;
                const radius = 4 + Math.random() * 3;
                ribosome.position.set(
                    Math.cos(angle) * radius,
                    (Math.random() - 0.5) * 6,
                    Math.sin(angle) * radius
                );
                ribosome.castShadow = true;
                prokaryoticGroup.add(ribosome);
            }
            
            prokaryoticGroup.position.set(-15, 0, 0);
            scene.add(prokaryoticGroup);
            
            // æ·»åŠ æ ‡ç­¾
            const label = createTextLabel('åŸæ ¸ç»†èƒ (å¤‡ç”¨)', new THREE.Vector3(-15, 15, 0));
            scene.add(label);
            
            prokaryoticLoaded = true;
        }
        
        // åˆ›å»ºBioDigitalçœŸæ ¸ç»†èƒ
        function createBioDigitalEukaryoticCell() {
            console.log('ğŸ”¬ åˆå§‹åŒ–BioDigitalçœŸæ ¸ç»†èƒ');
            updateStatus('eukaryotic', 'loading', 'åˆå§‹åŒ–BioDigital...');
            showEukaryoticLoading('æ­£åœ¨åŠ è½½BioDigitalçœŸæ ¸ç»†èƒ...');
            
            const container = document.getElementById('eukaryotic-container');
            
            // åˆ›å»ºBioDigitalå®¹å™¨
            const biodigitalContainer = document.createElement('div');
            biodigitalContainer.id = 'biodigital-eukaryotic-cell';
            
            // æ·»åŠ æ ‡é¢˜è¦†ç›–å±‚
            const overlay = document.createElement('div');
            overlay.className = 'biodigital-overlay';
            overlay.textContent = 'ğŸ”¬ çœŸæ ¸ç»†èƒ (BioDigital)';
            biodigitalContainer.appendChild(overlay);
            
            // ç›´æ¥ä½¿ç”¨iframeåŠ è½½BioDigitalæ¨¡å‹
            loadBioDigitalModel(biodigitalContainer, container);
        }
        
        // åŠ è½½BioDigitalæ¨¡å‹
        function loadBioDigitalModel(biodigitalContainer, container) {
            // å°è¯•å¤šä¸ªç»†èƒç›¸å…³çš„æ¨¡å‹ID
            const cellModelIds = [
                'production/maleAdult/cell',
                'production/femaleAdult/cell', 
                'production/maleAdult/cardiovascular_system',
                'production/maleAdult/respiratory_system',
                'maleAdult',
                'femaleAdult'
            ];
            
            let currentModelIndex = 0;
            
            function tryLoadModel() {
                const modelId = cellModelIds[currentModelIndex];
                console.log(`ğŸ§ª å°è¯•BioDigitalæ¨¡å‹: ${modelId}`);
                updateStatus('eukaryotic', 'loading', `å°è¯•æ¨¡å‹ ${currentModelIndex + 1}/${cellModelIds.length}`);
                
                // æ¸…ç†ä¹‹å‰çš„iframe
                const existingIframe = biodigitalContainer.querySelector('iframe');
                if (existingIframe) {
                    existingIframe.remove();
                }
                
                // åˆ›å»ºæ–°çš„iframe
                const iframe = document.createElement('iframe');
                iframe.id = 'biodigital-cell-widget';
                iframe.src = `https://human.biodigital.com/widget/?m=${modelId}&dk=${BIODIGITAL_API_KEY}&ui-info=false&ui-fullscreen=false&ui-help=false&ui-layers=false&ui-search=false&ui-menu=false&ui-tools=false&background=000000&initial_load=false`;
                iframe.style.display = 'none';
                
                biodigitalContainer.appendChild(iframe);
                container.appendChild(biodigitalContainer);
                
                // ç­‰å¾…HumanAPIåŠ è½½
                waitForHumanAPI(iframe, tryNextModel);
            }
            
            function tryNextModel() {
                currentModelIndex++;
                if (currentModelIndex < cellModelIds.length) {
                    setTimeout(tryLoadModel, 1000); // ç­‰å¾…1ç§’åå°è¯•ä¸‹ä¸€ä¸ª
                } else {
                    console.log('âš ï¸ æ‰€æœ‰BioDigitalæ¨¡å‹åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨Three.jsæ¨¡å‹');
                    updateStatus('eukaryotic', 'error', 'BioDigitalå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨');
                    showThreeJSEukaryoticCell();
                }
            }
            
            // å¼€å§‹å°è¯•åŠ è½½
            tryLoadModel();
        }
        
        // ç­‰å¾…HumanAPIåŠ è½½
        function waitForHumanAPI(iframe, fallbackCallback) {
            function checkAPI() {
                if (typeof HumanAPI !== 'undefined') {
                    console.log('âœ… HumanAPIå¯ç”¨');
                    
                    iframe.onload = function() {
                        try {
                            window.humanAPI = new HumanAPI("biodigital-cell-widget");
                            console.log('âœ… BioDigitalåˆå§‹åŒ–æˆåŠŸ');
                            
                            iframe.style.display = 'block';
                            biodigitalLoaded = true;
                            updateStatus('eukaryotic', 'success', 'BioDigitalä¸“ä¸šæ¨¡å‹');
                            hideEukaryoticLoading();
                            
                            // é…ç½®æ¨¡å‹
                            setTimeout(() => {
                                try {
                                    if (window.humanAPI) {
                                        window.humanAPI.send("timeline.pause");
                                        window.humanAPI.send("camera.set", {
                                            position: { x: 0, y: 0, z: -100 },
                                            target: { x: 0, y: 0, z: 0 },
                                            animate: true
                                        });
                                    }
                                } catch (e) {
                                    console.log('âš ï¸ BioDigitalé…ç½®å¤±è´¥ï¼ˆæ¨¡å‹ä»å¯ç”¨ï¼‰');
                                }
                            }, 2000);
                            
                        } catch (error) {
                            console.error('âŒ BioDigitalåˆå§‹åŒ–å¤±è´¥:', error);
                            fallbackCallback();
                        }
                    };
                    
                    iframe.onerror = fallbackCallback;
                    
                } else {
                    setTimeout(checkAPI, 500);
                }
            }
            
            checkAPI();
            
            // è¶…æ—¶ä¿æŠ¤
            setTimeout(() => {
                if (!biodigitalLoaded) {
                    console.log('â° BioDigitalåŠ è½½è¶…æ—¶');
                    fallbackCallback();
                }
            }, 10000);
        }
        
        // Three.jså¤‡ç”¨çœŸæ ¸ç»†èƒ
        function showThreeJSEukaryoticCell() {
            console.log('ğŸ”„ åˆ›å»ºThree.jså¤‡ç”¨çœŸæ ¸ç»†èƒ');
            updateStatus('eukaryotic', 'error', 'Three.jså¤‡ç”¨æ¨¡å‹');
            hideEukaryoticLoading();
            
            // éšè—BioDigitalå®¹å™¨
            const biodigitalContainer = document.getElementById('biodigital-eukaryotic-cell');
            if (biodigitalContainer) {
                biodigitalContainer.style.display = 'none';
            }
            
            const eukaryoticGroup = new THREE.Group();
            
            // ç»†èƒè†œ
            const cellGeometry = new THREE.SphereGeometry(10, 32, 32);
            const cellMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x95D4F3, 
                transparent: true, 
                opacity: 0.3 
            });
            const cellMembrane = new THREE.Mesh(cellGeometry, cellMaterial);
            cellMembrane.castShadow = true;
            eukaryoticGroup.add(cellMembrane);
            
            // ç»†èƒæ ¸
            const nucleusGeometry = new THREE.SphereGeometry(4, 32, 32);
            const nucleusMaterial = new THREE.MeshLambertMaterial({ color: 0x1660AB });
            const nucleus = new THREE.Mesh(nucleusGeometry, nucleusMaterial);
            nucleus.castShadow = true;
            eukaryoticGroup.add(nucleus);
            
            // çº¿ç²’ä½“
            for (let i = 0; i < 8; i++) {
                const mitoGeometry = new THREE.SphereGeometry(1, 16, 16);
                const mitoMaterial = new THREE.MeshLambertMaterial({ color: 0xA61B29 });
                const mitochondria = new THREE.Mesh(mitoGeometry, mitoMaterial);
                
                const angle = (i / 8) * Math.PI * 2;
                mitochondria.position.set(
                    Math.cos(angle) * 6,
                    (Math.random() - 0.5) * 4,
                    Math.sin(angle) * 6
                );
                mitochondria.castShadow = true;
                eukaryoticGroup.add(mitochondria);
            }
            
            eukaryoticGroup.position.set(15, 0, 0);
            scene.add(eukaryoticGroup);
            
            // æ·»åŠ æ ‡ç­¾
            const label = createTextLabel('çœŸæ ¸ç»†èƒ (å¤‡ç”¨)', new THREE.Vector3(15, 15, 0));
            scene.add(label);
        }
        
        // åˆ›å»ºæ–‡å­—æ ‡ç­¾
        function createTextLabel(text, position) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 300;
            canvas.height = 80;
            
            // èƒŒæ™¯
            context.fillStyle = 'rgba(249, 242, 224, 0.95)';
            context.roundRect(0, 0, 300, 80, 10);
            context.fill();
            
            // è¾¹æ¡†
            context.strokeStyle = 'rgba(9, 55, 92, 0.3)';
            context.lineWidth = 2;
            context.stroke();
            
            // æ–‡å­—
            context.fillStyle = '#2B313F';
            context.font = 'bold 20px Arial';
            context.textAlign = 'center';
            context.fillText(text, 150, 50);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.position.copy(position);
            sprite.scale.set(10, 2.7, 1);
            
            return sprite;
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);
            
            // æ›´æ–°æ§åˆ¶å™¨
            if (controls) {
                controls.update();
            }
            
            // æ¸²æŸ“åœºæ™¯
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        function handleResize() {
            if (camera && renderer) {
                const container = document.getElementById('prokaryotic-container');
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            }
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            enterButton.addEventListener('click', enterMainApp);
            window.addEventListener('resize', handleResize);
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(event) {
                switch(event.code) {
                    case 'KeyR': // Ré”®é‡ç½®è§†è§’
                        if (camera && controls) {
                            camera.position.set(0, 15, 35);
                            controls.reset();
                        }
                        break;
                    case 'KeyF': // Fé”®å…¨å±
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            document.documentElement.requestFullscreen();
                        }
                        break;
                }
            });
        }
        
        // æ‰©å±•CanvasRenderingContext2Dçš„roundRectæ–¹æ³•ï¼ˆå…¼å®¹æ€§ï¼‰
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
            };
        }
        
        // æ§åˆ¶é¢æ¿åŠŸèƒ½å®ç°
        function resetCamera() {
            console.log('ğŸ“· é‡ç½®ç›¸æœºè§†è§’');
            if (camera && controls) {
                camera.position.set(0, 15, 35);
                controls.reset();
            }
        }
        
        function toggleFullscreen() {
            console.log('ğŸ–¥ï¸ åˆ‡æ¢å…¨å±æ¨¡å¼');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }
        
        function highlightPart(cellType, partName) {
            console.log(`ğŸ¯ é«˜äº®${cellType}ç»†èƒçš„${partName}`);
            // è¿™é‡Œå¯ä»¥å®ç°å…·ä½“çš„é«˜äº®é€»è¾‘
            // ç›®å‰åªæ˜¯UIåé¦ˆ
            event.target.classList.toggle('active');
        }
        
        function clearHighlight() {
            console.log('ğŸ§¹ æ¸…é™¤æ‰€æœ‰é«˜äº®');
            const buttons = document.querySelectorAll('.highlight-btn.active');
            buttons.forEach(btn => btn.classList.remove('active'));
        }
        
        function highlightEukaryoticPart(partName) {
            console.log(`ğŸ¯ å°è¯•é«˜äº®çœŸæ ¸ç»†èƒçš„${partName}`);
            
            if (window.humanAPI && biodigitalLoaded) {
                try {
                    // ä½¿ç”¨åŸºæœ¬çš„Viewer APIåŠŸèƒ½
                    // æ³¨æ„ï¼šç”±äºåªæœ‰Viewer APIæƒé™ï¼Œé«˜äº®åŠŸèƒ½å¯èƒ½æœ‰é™
                    const commands = {
                        'nucleus': () => {
                            window.humanAPI.send("camera.set", {
                                position: { x: 0, y: 0, z: -50 },
                                target: { x: 0, y: 0, z: 0 },
                                animate: true
                            });
                        },
                        'mitochondria': () => {
                            window.humanAPI.send("camera.set", {
                                position: { x: 25, y: 25, z: -25 },
                                target: { x: 0, y: 0, z: 0 },
                                animate: true
                            });
                        },
                        'er': () => {
                            window.humanAPI.send("camera.set", {
                                position: { x: -25, y: 0, z: -25 },
                                target: { x: 0, y: 0, z: 0 },
                                animate: true
                            });
                        },
                        'golgi': () => {
                            window.humanAPI.send("camera.set", {
                                position: { x: 0, y: 25, z: -25 },
                                target: { x: 0, y: 0, z: 0 },
                                animate: true
                            });
                        }
                    };
                    
                    if (commands[partName]) {
                        commands[partName]();
                        updateStatus('eukaryotic', 'success', `èšç„¦: ${partName}`);
                    } else {
                        updateStatus('eukaryotic', 'loading', 'åŠŸèƒ½æœ‰é™');
                    }
                    
                } catch (e) {
                    console.log('âš ï¸ BioDigitalæ“ä½œå¤±è´¥:', e);
                    updateStatus('eukaryotic', 'error', 'æ“ä½œå¤±è´¥');
                }
            } else {
                updateStatus('eukaryotic', 'error', 'BioDigitalæœªåŠ è½½');
            }
            
            event.target.classList.toggle('active');
        }
        
        function clearEukaryoticHighlight() {
            console.log('ğŸ”„ é‡ç½®çœŸæ ¸ç»†èƒè§†å›¾');
            if (window.humanAPI && biodigitalLoaded) {
                try {
                    window.humanAPI.send("camera.reset");
                    updateStatus('eukaryotic', 'success', 'è§†å›¾å·²é‡ç½®');
                } catch (e) {
                    console.log('âš ï¸ BioDigitalé‡ç½®å¤±è´¥:', e);
                }
            }
            const buttons = document.querySelectorAll('.highlight-btn.active');
            buttons.forEach(btn => btn.classList.remove('active'));
        }
        
        function toggleAnimation(cellType) {
            console.log(`ğŸ¬ åˆ‡æ¢${cellType}ç»†èƒåŠ¨ç”»`);
            const checkbox = document.getElementById(`${cellType}-animation`);
            // è¿™é‡Œå¯ä»¥å®ç°å…·ä½“çš„åŠ¨ç”»åˆ‡æ¢é€»è¾‘
        }
        
        function testBioDigitalAPI() {
            console.log('ğŸ§ª æµ‹è¯•BioDigital Viewer API');
            if (window.humanAPI && biodigitalLoaded) {
                updateStatus('eukaryotic', 'loading', 'æµ‹è¯•API...');
                try {
                    // æµ‹è¯•åŸºæœ¬çš„Viewer APIåŠŸèƒ½
                    window.humanAPI.send("camera.info", function(data) {
                        console.log('ğŸ“¹ ç›¸æœºä¿¡æ¯:', data);
                        updateStatus('eukaryotic', 'success', 'Viewer APIæ­£å¸¸');
                        
                        // æ˜¾ç¤ºç®€å•çš„APIä¿¡æ¯
                        setTimeout(() => {
                            alert(`BioDigital Viewer APIæµ‹è¯•æˆåŠŸï¼\nç›¸æœºä½ç½®: ${JSON.stringify(data.position || {})}\næ¨¡å‹å·²åŠ è½½ä¸”å¯äº¤äº’`);
                        }, 500);
                    });
                    
                } catch (e) {
                    console.error('âŒ APIæµ‹è¯•å¤±è´¥:', e);
                    updateStatus('eukaryotic', 'error', 'APIæµ‹è¯•å¤±è´¥');
                }
            } else {
                updateStatus('eukaryotic', 'error', 'BioDigitalæœªåŠ è½½');
                console.log('âŒ BioDigitalæœªåŠ è½½æˆ–APIä¸å¯ç”¨');
            }
        }
        
        function resetBioDigitalView() {
            console.log('ğŸ”„ é‡ç½®BioDigitalè§†å›¾');
            if (window.humanAPI && biodigitalLoaded) {
                try {
                    window.humanAPI.send("camera.reset");
                    updateStatus('eukaryotic', 'success', 'è§†å›¾å·²é‡ç½®');
                } catch (e) {
                    console.log('âš ï¸ BioDigitalé‡ç½®å¤±è´¥:', e);
                    updateStatus('eukaryotic', 'error', 'é‡ç½®å¤±è´¥');
                }
            } else {
                updateStatus('eukaryotic', 'error', 'BioDigitalæœªåŠ è½½');
            }
        }
        
        function showModelInfo() {
            console.log('ğŸ“Š æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯');
            if (window.humanAPI && biodigitalLoaded) {
                window.humanAPI.send("camera.info", function(data) {
                    const info = `BioDigitalçœŸæ ¸ç»†èƒæ¨¡å‹
                    
ğŸ¯ APIç±»å‹: Viewer API
ğŸ“¹ ç›¸æœºä½ç½®: (${data.position?.x || 0}, ${data.position?.y || 0}, ${data.position?.z || 0})
ğŸ”‘ API Key: ${BIODIGITAL_API_KEY.substring(0, 8)}...
âœ… çŠ¶æ€: å·²åŠ è½½å¹¶å¯äº¤äº’

ğŸ“ è¯´æ˜: ä½¿ç”¨BioDigitalä¸“ä¸šåŒ»å­¦3Dæ¨¡å‹å±•ç¤ºçœŸæ ¸ç»†èƒç»“æ„`;
                    alert(info);
                });
            } else {
                alert('BioDigitalæ¨¡å‹æœªåŠ è½½æˆ–APIä¸å¯ç”¨');
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            console.log('ğŸ¬ åˆå§‹åŒ–ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°');
            
            // è®¾ç½®æ„å»ºæ—¶é—´
            const buildTimeElement = document.getElementById('build-time');
            if (buildTimeElement) {
                buildTimeElement.textContent = new Date().toLocaleString();
            }
            
            setupEventListeners();
            initVideoIntro();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        console.log('âœ… å¹³å°è„šæœ¬åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
