<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- å¼ºåˆ¶åˆ·æ–°æ—¶é—´æˆ³ -->
    <meta name="timestamp" content="2025-06-27-14:30:00">
    <meta name="version" content="FINAL-FIX-v2.0">
    
    <title>ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å° v2.0</title>
    
    <!-- é¡µé¢åŠ è½½å‰çš„ç´§æ€¥æ‹¦æˆªè„šæœ¬ -->
    <script>
        // ç´§æ€¥æ‹¦æˆª - åœ¨ä»»ä½•å…¶ä»–è„šæœ¬ä¹‹å‰æ‰§è¡Œ
        console.log('ğŸš¨ ç´§æ€¥æ‹¦æˆªå™¨å¯åŠ¨ - æ—¶é—´:', new Date().toISOString());
        
        // ç«‹å³æ£€æŸ¥URLæ˜¯å¦åŒ…å«intro
        if (window.location.href.includes('intro')) {
            console.error('ğŸš« æ£€æµ‹åˆ°URLä¸­åŒ…å«introï¼Œå¼ºåˆ¶é‡å®šå‘');
            window.location.replace(window.location.href.split('?')[0]);
        }
        
        // æ¸…ç†å¯èƒ½çš„ç¼“å­˜
        if (window.caches) {
            caches.keys().then(names => {
                names.forEach(name => {
                    if (name.includes('intro')) {
                        caches.delete(name);
                        console.log('ğŸ—‘ï¸ åˆ é™¤ç¼“å­˜:', name);
                    }
                });
            });
        }
    </script>
    
    <!-- ç«‹å³æ‰§è¡Œçš„ç¼“å­˜æ¸…ç†è„šæœ¬ -->
    <script>
        // === ç»ˆæå¼ºåˆ¶é‡ç½®å’Œæ¸…ç†ç³»ç»Ÿ ===
        console.clear(); // æ¸…ç†æ§åˆ¶å°
        console.log('ğŸ”„ === ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å° v2.0 å¯åŠ¨ ===');
        console.log('ğŸš¨ æ‰§è¡Œå¼ºåˆ¶ç¼“å­˜æ¸…ç†å’Œé”™è¯¯ä¿®å¤...');
        
        // æ·»åŠ æ—¶é—´æˆ³ç¡®ä¿è¿™æ˜¯æœ€æ–°ç‰ˆæœ¬
        console.log('â° å½“å‰æ—¶é—´:', new Date().toISOString());
        console.log('ğŸ“ ç‰ˆæœ¬:', '2025-06-27-FINAL');
        
        // ç«‹å³æ¸…ç†æ‰€æœ‰å­˜å‚¨
        try {
            localStorage.clear();
            sessionStorage.clear();
            // é¢å¤–æ¸…ç†å¯èƒ½çš„ç¼“å­˜é”®
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('video') || key.includes('intro')) {
                    localStorage.removeItem(key);
                }
            }
            console.log('âœ… å­˜å‚¨å½»åº•æ¸…ç†å®Œæˆ');
        } catch(e) {
            console.log('âš ï¸ å­˜å‚¨æ¸…ç†å¤±è´¥:', e);
        }
        
        // === è¶…çº§å¼ºåŒ–ç½‘ç»œè¯·æ±‚æ‹¦æˆªå™¨ ===
        
        // æ‹¦æˆªæ‰€æœ‰å¯èƒ½çš„ç½‘ç»œè¯·æ±‚æ–¹å¼
        const blockedPaths = ['intro1.mp4', 'intro2.mp4', 'intro3.mp4', 'intro4.mp4'];
        
        // 1. æ‹¦æˆª fetch è¯·æ±‚
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const urlString = typeof url === 'string' ? url : url.url || url.href || '';
            
            for (const blocked of blockedPaths) {
                if (urlString.includes(blocked)) {
                    console.error('ğŸš« FETCHè¯·æ±‚å·²è¢«æ‹¦æˆª:', urlString);
                    return Promise.reject(new Error('è¯·æ±‚è¢«å®‰å…¨ç­–ç•¥é˜»æ­¢: ' + urlString));
                }
            }
            return originalFetch.apply(this, args);
        };
        
        // 2. æ‹¦æˆª XMLHttpRequest
        const originalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new originalXHR();
            const originalOpen = xhr.open;
            xhr.open = function(method, url, ...args) {
                const urlString = typeof url === 'string' ? url : '';
                for (const blocked of blockedPaths) {
                    if (urlString.includes(blocked)) {
                        console.error('ğŸš« XHRè¯·æ±‚å·²è¢«æ‹¦æˆª:', urlString);
                        throw new Error('è¯·æ±‚è¢«å®‰å…¨ç­–ç•¥é˜»æ­¢: ' + urlString);
                    }
                }
                return originalOpen.apply(this, [method, url, ...args]);
            };
            return xhr;
        };
        
        // 3. æ‹¦æˆª createElement ä¸­çš„åª’ä½“å…ƒç´ 
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(this, tagName);
            if (tagName.toLowerCase() === 'video' || tagName.toLowerCase() === 'audio') {
                const originalSetAttribute = element.setAttribute;
                element.setAttribute = function(name, value) {
                    if (name === 'src' && typeof value === 'string') {
                        for (const blocked of blockedPaths) {
                            if (value.includes(blocked)) {
                                console.error('ğŸš« åª’ä½“å…ƒç´ srcè®¾ç½®å·²è¢«æ‹¦æˆª:', value);
                                return; // é˜»æ­¢è®¾ç½®
                            }
                        }
                    }
                    return originalSetAttribute.call(this, name, value);
                };
                
                // æ‹¦æˆªç›´æ¥çš„srcå±æ€§è®¾ç½®
                Object.defineProperty(element, 'src', {
                    set: function(value) {
                        if (typeof value === 'string') {
                            for (const blocked of blockedPaths) {
                                if (value.includes(blocked)) {
                                    console.error('ğŸš« åª’ä½“å…ƒç´ srcå±æ€§è®¾ç½®å·²è¢«æ‹¦æˆª:', value);
                                    return; // é˜»æ­¢è®¾ç½®
                                }
                            }
                        }
                        // ä½¿ç”¨åå°„è®¾ç½®åŸå§‹å±æ€§
                        element.setAttribute('src', value);
                    },
                    get: function() {
                        return element.getAttribute('src');
                    }
                });
            }
            return element;
        };
        
        console.log('ğŸš« å·²éƒ¨ç½²ä¸‰å±‚intro*.mp4æ–‡ä»¶è®¿é—®æ‹¦æˆªå™¨');
        console.log('âœ… åªå…è®¸è®¿é—®animation/animation.mp4');
        
        // 4. ç›‘æ§æ‰€æœ‰ç½‘ç»œæ´»åŠ¨ï¼ˆå¼€å‘è€…å·¥å…·ï¼‰
        if (window.performance && window.performance.getEntriesByType) {
            setInterval(() => {
                const resources = window.performance.getEntriesByType('resource');
                resources.forEach(resource => {
                    if (resource.name.includes('intro') && resource.name.includes('.mp4')) {
                        console.error('ğŸš¨ æ£€æµ‹åˆ°introç±»è§†é¢‘æ–‡ä»¶ç½‘ç»œè¯·æ±‚:', resource.name);
                        console.error('ğŸš¨ è¿™ä¸åº”è¯¥å‘ç”Ÿï¼è¯·æ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ã€‚');
                    }
                });
            }, 1000);
        }
        
        // 5. æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†å™¨
        window.addEventListener('error', function(event) {
            if (event.filename && event.filename.includes('intro') && event.filename.includes('.mp4')) {
                console.error('ğŸš¨ æ£€æµ‹åˆ°introç±»è§†é¢‘æ–‡ä»¶é”™è¯¯:', event.filename);
                event.preventDefault();
                return false;
            }
        });
        
        // 6. å¼ºåˆ¶é‡ç½®videoå…ƒç´ 
        document.addEventListener('DOMContentLoaded', function() {
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                video.src = '';
                video.load();
                video.pause();
                console.log('ğŸ”„ é‡ç½®videoå…ƒç´ :', video.id || 'unnamed');
            });
        });
        
        // æ¸…ç†Service Workerï¼ˆä»…åœ¨HTTPSç¯å¢ƒä¸‹è¿è¡Œï¼‰
        if ('serviceWorker' in navigator && location.protocol === 'https:') {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                    console.log('ğŸ—‘ï¸ æ³¨é”€Service Worker:', registration.scope);
                }
            }).catch(function(error) {
                console.log('âš ï¸ Service Workeræ¸…ç†å¤±è´¥ï¼ˆæœ¬åœ°æ–‡ä»¶æ­£å¸¸ï¼‰:', error.message);
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/OBJLoader.js"></script>
    <!-- BioDigital API - ä½¿ç”¨å®˜æ–¹æ¨èçš„v3.0.0 -->
    <script src="https://developer.biodigital.com/builds/api/human-api-3.0.0.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #09375C, #3DA4E6, #95D4F3);
        }
        
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #09375C, #2B313F);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(9, 55, 92, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1001;
        }
        
        #platform-title {
            color: #F9F2E0;
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.5s ease;
            margin-bottom: 30px;
        }
        
        #platform-title.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        #enter-button {
            margin-top: 20px;
            padding: 20px 40px;
            font-size: 18px;
            background: rgba(249, 242, 224, 0.15);
            color: #F9F2E0;
            border: 2px solid rgba(249, 242, 224, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(20px);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        #enter-button.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        #enter-button:hover {
            background: rgba(249, 242, 224, 0.25);
            border-color: rgba(249, 242, 224, 0.6);
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
        
        #container {
            display: flex;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #E3E3E5, #C6E6E8);
        }
        
        #control-panel {
            width: 300px;
            padding: 20px;
            background: linear-gradient(135deg, #F9F2E0, #F7ECE7);
            box-shadow: 0 0 20px rgba(9, 55, 92, 0.2);
            overflow-y: auto;
            z-index: 10;
            border-right: 3px solid #1660AB;
        }
        
        #render-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #95D4F3, #3DA4E6, #09375C);
        }
        
        h1, h2, h3 {
            color: #2B313F;
        }
        
        h1 {
            color: #A61B29;
            border-bottom: 3px solid #A61B29;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #1660AB;
            border-bottom: 2px solid #1660AB;
            padding-bottom: 8px;
        }
        
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border-left: 4px solid #1660AB;
            backdrop-filter: blur(5px);
        }
        
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .common {
            color: #2ecc71;
        }
        
        .difference {
            color: #e74c3c;
        }
        
        .slider-container {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            border-left: 3px solid #3DA4E6;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2B313F;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #95D4F3, #3DA4E6, #09375C);
            outline: none;
        }
        
        .cell-label {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            pointer-events: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            color: #333;
            border: 2px solid #007acc;
        }
        
        .info-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 380px;
            height: 100vh;
            background: linear-gradient(135deg, #F9F2E0, #E2E7BF);
            box-shadow: -5px 0 25px rgba(9, 55, 92, 0.3);
            z-index: 1000;
            padding: 25px;
            overflow-y: auto;
            transition: right 0.4s ease;
            border-left: 3px solid #1660AB;
        }
        
        .info-panel.open {
            right: 0;
        }
        
        .info-panel h2 {
            color: #A61B29;
            border-bottom: 3px solid #A61B29;
            padding-bottom: 12px;
            text-shadow: 0 2px 4px rgba(166, 27, 41, 0.2);
        }
        
        .info-panel h3 {
            color: #1660AB;
            margin-top: 20px;
        }
        
        .info-panel h4 {
            color: #2B313F;
            margin-top: 15px;
        }
        
        .comparison-button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, rgba(22, 96, 171, 0.1), rgba(226, 231, 191, 0.3));
            border: 2px solid #1660AB;
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #2B313F;
            backdrop-filter: blur(5px);
        }
        
        .comparison-button:hover {
            background: linear-gradient(135deg, rgba(22, 96, 171, 0.2), rgba(226, 231, 191, 0.5));
            border-color: #A61B29;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(22, 96, 171, 0.3);
        }
        
        .comparison-button.active {
            background: linear-gradient(135deg, #1660AB, #3DA4E6);
            color: #F9F2E0;
            border-color: #09375C;
            box-shadow: 0 8px 25px rgba(9, 55, 92, 0.4);
        }
        
        .sub-buttons {
            display: none;
            margin-top: 10px;
            padding-left: 20px;
            background: rgba(247, 236, 231, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        
        .sub-buttons.show {
            display: block;
        }
        
        .sub-button {
            padding: 10px 15px;
            margin: 5px 0;
            background: linear-gradient(135deg, #707899, #373834);
            color: #F9F2E0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .sub-button:hover {
            background: linear-gradient(135deg, #A61B29, #707899);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(166, 27, 41, 0.3);
        }
        
        .sub-button.active {
            background: linear-gradient(135deg, #A61B29, #2B313F);
            box-shadow: 0 6px 20px rgba(166, 27, 41, 0.4);
        }
        
        @media (max-width: 768px) {
            #container {
                flex-direction: column;
            }
            
            #control-panel {
                width: 100%;
                height: 40vh;
                overflow-y: scroll;
            }
            
            #render-container {
                height: 60vh;
            }
            
            .info-panel {
                width: 90%;
                right: -90%;
            }
        }
        
        .toggle-button {
            padding: 10px 15px;
            margin: 5px;
            background: linear-gradient(135deg, #3DA4E6, #95D4F3);
            color: #09375C;
            border: 2px solid #1660AB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .toggle-button.active {
            background: linear-gradient(135deg, #1660AB, #09375C);
            color: #F9F2E0;
            box-shadow: 0 4px 15px rgba(9, 55, 92, 0.4);
        }
        
        .toggle-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(61, 164, 230, 0.3);
        }

        /* ä¿¡æ¯é¢æ¿æ ·å¼ */
        .info-panel {
            background: linear-gradient(135deg, rgba(9, 55, 92, 0.15), rgba(166, 27, 41, 0.1));
            border: 1px solid rgba(249, 242, 224, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .info-panel p {
            margin: 5px 0;
            color: #F9F2E0;
            font-size: 14px;
            opacity: 0.9;
        }

        /* éšè—BioDigitalæ¨¡å‹ä¸­çš„é”™è¯¯æç¤ºå’Œå¼¹çª— */
        #biodigital-prokaryotic-cell iframe {
            pointer-events: auto;
        }
        
        /* ç¡®ä¿BioDigitalå®¹å™¨è¦†ç›–ä»»ä½•å¯èƒ½çš„å¼¹çª— */
        #biodigital-prokaryotic-cell {
            isolation: isolate;
        }

        /* éšè—å¯èƒ½çš„BioDigitalé”™è¯¯å¼¹çª—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰*/
        .biodigital-error-popup,
        .human-loading-screen,
        .human-error-message {
            display: none !important;
            visibility: hidden !important;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- è§†é¢‘åŠ è½½ç•Œé¢ -->
    <div id="video-container">
        <!-- è§†é¢‘æ’­æ”¾å™¨ -->
        <video id="intro-video" autoplay muted>
            <!-- åŠ¨æ€åŠ è½½è§†é¢‘æº -->
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
        </video>
        
        <!-- è¦†ç›–å±‚ -->
        <div id="video-overlay">
            <div id="loading-indicator" style="color: #F9F2E0; font-size: 18px; margin-bottom: 20px; opacity: 1;">
                æ­£åœ¨æ£€æµ‹æ–‡ä»¶... (animation.mp4ç¼ºå¤±ï¼Œå°†è·³è¿‡å¼€åœºåŠ¨ç”»)
            </div>
            <h1 id="platform-title">ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°</h1>
            <button id="enter-button">è¿›å…¥ä¸»ç•Œé¢</button>
        </div>
    </div>
    
    <!-- ä¸»ç•Œé¢ -->
    <div id="container" style="display: none;">
        <div id="control-panel">
            <h1>ç»†èƒç»“æ„å¯¹æ¯”</h1>
            
            <div class="section">
                <h2>ç‰¹æ€§å¯¹æ¯”</h2>
                
                <button class="comparison-button" data-type="common">
                    å…±æœ‰ç‰¹æ€§ â–¼
                </button>
                <div class="sub-buttons" data-parent="common">
                    <button class="sub-button" data-feature="cell-membrane">ç»†èƒè†œï¼ˆè´¨è†œï¼‰</button>
                    <button class="sub-button" data-feature="cytoplasm">ç»†èƒè´¨åŸºè´¨</button>
                    <button class="sub-button" data-feature="ribosomes">æ ¸ç³–ä½“</button>
                    <button class="sub-button" data-feature="dna">DNAé—ä¼ ç‰©è´¨</button>
                    <button class="sub-button" data-feature="metabolism">ä»£è°¢æ´»åŠ¨</button>
                </div>
                
                <button class="comparison-button" data-type="differences">
                    ä¸»è¦åŒºåˆ« â–¼
                </button>
                <div class="sub-buttons" data-parent="differences">
                    <button class="sub-button" data-feature="cell-wall">ç»†èƒå£ç»“æ„</button>
                    <button class="sub-button" data-feature="nucleus">ç»†èƒæ ¸</button>
                    <button class="sub-button" data-feature="organelles">è†œæ€§ç»†èƒå™¨</button>
                    <button class="sub-button" data-feature="size">ç»†èƒå¤§å°</button>
                    <button class="sub-button" data-feature="complexity">ç»“æ„å¤æ‚åº¦</button>
                </div>
            </div>
            
            <div class="section">
                <h2>æ¨¡å‹æ§åˆ¶</h2>
                
                <div class="slider-container">
                    <label for="opacity-slider">æ•´ä½“é€æ˜åº¦</label>
                    <input type="range" id="opacity-slider" class="slider" min="0" max="1" step="0.1" value="1">
                </div>
                
                <div class="button-group">
                    <button class="toggle-button active" data-cell="prokaryotic" data-part="all">åŸæ ¸ç»†èƒ (BioDigital)</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="all">çœŸæ ¸ç»†èƒ</button>
                </div>
                

                
                <h3>åŸæ ¸ç»†èƒç»“æ„ (BioDigitalä¸“ä¸šæ¨¡å‹)</h3>
                <div class="info-panel">
                    <p>ğŸ”¬ å·¦ä¾§æ˜¾ç¤ºçš„æ˜¯ä¸“ä¸šçº§BioDigitalåŸæ ¸ç»†èƒæ¨¡å‹</p>
                    <p>âœ¨ å…·æœ‰é«˜ç²¾åº¦3Då¯è§†åŒ–å’Œäº¤äº’åŠŸèƒ½</p>
                </div>
                
                <h3>çœŸæ ¸ç»†èƒç»“æ„</h3>
                <div class="button-group">
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="cellMembrane">ç»†èƒè†œ</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="nucleus">ç»†èƒæ ¸</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="mitochondria">çº¿ç²’ä½“</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="endoplasmicReticulum">å†…è´¨ç½‘</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="golgiApparatus">é«˜å°”åŸºä½“</button>
                    <button class="toggle-button active" data-cell="eukaryotic" data-part="lysosomes">æº¶é…¶ä½“</button>
                </div>
            </div>
            
            <div class="section">
                <h2>ç»†èƒä¿¡æ¯</h2>
                <div id="cell-info">
                    <p>ç‚¹å‡»ç»†èƒç»“æ„æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                </div>
            </div>
        </div>
        
        <div id="render-container"></div>
        
        <!-- å³ä¾§ä¿¡æ¯é¢æ¿ -->
        <div id="info-panel" class="info-panel">
            <h2 id="info-title">ç»“æ„è¯¦æƒ…</h2>
            <div id="info-content">
                <p>é€‰æ‹©å·¦ä¾§æŒ‰é’®æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸ”¬ ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°å¯åŠ¨ä¸­...');
        console.log('ğŸ“ é¢„æœŸæ–‡ä»¶ç»“æ„:');
        console.log('   ğŸ“„ cell2.html (å½“å‰æ–‡ä»¶)');
        console.log('   ğŸ¬ animation.mp4 (å¼€åœºåŠ¨ç”»è§†é¢‘ - åŒç›®å½•) - âš ï¸ æ–‡ä»¶ç¼ºå¤±');
        console.log('   ğŸ“ cell_model1/ (3Dæ¨¡å‹æ–‡ä»¶å¤¹) - âš ï¸ æ–‡ä»¶å¤¹ç¼ºå¤±');
        console.log('      ğŸ® model.gltf/model.glb/model.obj (åŸæ ¸ç»†èƒ3Dæ¨¡å‹)');
        console.log('ğŸš« æ³¨æ„: ä¸å†æ”¯æŒintro1.mp4ã€intro2.mp4ç­‰æ—§æ ¼å¼è§†é¢‘');
        console.log('âš ï¸ æç¤º: ç”±äºç¼ºå°‘åª’ä½“æ–‡ä»¶ï¼Œå°†ç›´æ¥è¿›å…¥æ¼”ç¤ºæ¨¡å¼');
        
        // æ£€æŸ¥fetchæ˜¯å¦å·²è¢«é‡å†™
        if (!window.fetchIntercepted) {
            // æ ‡è®°å·²æ‹¦æˆª
            window.fetchIntercepted = true;
            console.log('âœ… fetchæ‹¦æˆªå™¨å·²å°±ä½ï¼Œæ— éœ€é‡å¤è®¾ç½®');
        }
        
        // é˜»æ­¢videoå…ƒç´ åŠ è½½introç±»æ–‡ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('intro-video');
            if (video) {
                video.addEventListener('loadstart', function() {
                    if (video.src.includes('intro') && video.src.includes('.mp4')) {
                        console.error('ğŸš« é˜»æ­¢videoå…ƒç´ åŠ è½½introç±»æ–‡ä»¶:', video.src);
                        video.pause();
                        video.src = '';
                        video.load();
                    }
                });
            }
        });

        // è§†é¢‘åŠ è½½ç•Œé¢æ§åˆ¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°');
            console.log('ğŸ“‹ é‡è¦è¯´æ˜: æœ¬å¹³å°åªä¼šæ’­æ”¾animation/animation.mp4ï¼Œç»ä¸åŠ è½½intro*.mp4æ–‡ä»¶');
            
            const videoContainer = document.getElementById('video-container');
            const introVideo = document.getElementById('intro-video');
            const platformTitle = document.getElementById('platform-title');
            const enterButton = document.getElementById('enter-button');
            const mainContainer = document.getElementById('container');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            // ç«‹å³æ¸…ç†ä»»ä½•å¯èƒ½çš„ç¼“å­˜å¼•ç”¨
            console.log('ğŸ§¹ æ¸…ç†videoå…ƒç´ çŠ¶æ€...');
            introVideo.src = '';
            introVideo.load(); // é‡ç½®videoå…ƒç´ çŠ¶æ€
            introVideo.pause();
            
            // æ¸…ç†å¯èƒ½çš„localStorageç¼“å­˜
            try {
                localStorage.removeItem('lastVideoSrc');
                localStorage.removeItem('introVideos');
                localStorage.removeItem('currentVideoIndex');
                console.log('ğŸ—‘ï¸  æ¸…ç†localStorageå®Œæˆ');
            } catch (e) {
                console.log('âš ï¸  æ¸…ç†localStorageå¤±è´¥ï¼ˆå¯èƒ½è¢«ç¦ç”¨ï¼‰:', e.message);
            }
            
            // åŠ è½½å¹¶æ’­æ”¾è§†é¢‘ - åªæ’­æ”¾animation.mp4ï¼Œç»ä¸åŠ è½½å…¶ä»–æ–‡ä»¶
            async function loadAndPlayNextVideo() {
                console.log('=== å¼€å§‹æ’­æ”¾animation.mp4è§†é¢‘ ===');
                console.log('âš ï¸  é‡è¦æç¤º: åªä¼šåŠ è½½animation.mp4ï¼Œç»ä¸ä¼šåŠ è½½intro1.mp4ç­‰å…¶ä»–æ–‡ä»¶');
                
                // æ˜ç¡®æŒ‡å®šè¦åŠ è½½çš„è§†é¢‘æ–‡ä»¶å
                const targetVideoFileName = 'animation.mp4';
                
                // è·å–å½“å‰é¡µé¢ä¿¡æ¯
                const currentPath = window.location.pathname;
                const currentHref = window.location.href;
                console.log('å½“å‰é¡µé¢è·¯å¾„:', currentPath);
                console.log('å½“å‰é¡µé¢å®Œæ•´URL:', currentHref);
                
                // æ£€æµ‹HTMLæ–‡ä»¶æ˜¯å¦åœ¨animationæ–‡ä»¶å¤¹å†…
                const isInAnimationFolder = currentPath.includes('/animation/') || 
                                          currentPath.includes('\\animation\\') ||
                                          currentPath.endsWith('/animation') ||
                                          currentPath.endsWith('\\animation');
                
                console.log('æ˜¯å¦åœ¨animationæ–‡ä»¶å¤¹å†…:', isInAnimationFolder);
                
                // æ ¹æ®HTMLæ–‡ä»¶ä½ç½®ç¡®å®šè§†é¢‘è·¯å¾„ - HTMLå’Œanimation.mp4åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹
                let videoSrc = targetVideoFileName; // ç›´æ¥ä½¿ç”¨æ–‡ä»¶å
                console.log('HTMLå’Œè§†é¢‘æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ï¼Œä½¿ç”¨ç›´æ¥è·¯å¾„:', videoSrc);
                
                // å†æ¬¡ç¡®è®¤ä¸ä¼šåŠ è½½é”™è¯¯çš„æ–‡ä»¶
                if (videoSrc.includes('intro') || !videoSrc.includes('animation.mp4')) {
                    console.error('âŒ è‡´å‘½é”™è¯¯: æ£€æµ‹åˆ°å°è¯•åŠ è½½éanimation.mp4æ–‡ä»¶:', videoSrc);
                    console.error('âŒ å¼ºåˆ¶ä¿®æ­£ä¸ºæ­£ç¡®è·¯å¾„');
                    videoSrc = 'animation.mp4'; // ç›´æ¥ä½¿ç”¨åŒç›®å½•ä¸‹çš„æ–‡ä»¶å
                }
                
                // æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                console.log('å¼€å§‹æ£€æµ‹è§†é¢‘æ–‡ä»¶...');
                try {
                    const exists = await checkVideoExists(videoSrc);
                    if (exists) {
                        console.log(`âœ“ æ‰¾åˆ°è§†é¢‘æ–‡ä»¶: ${videoSrc}`);
                        
                        // æ›´æ–°åŠ è½½æç¤º
                        if (loadingIndicator) {
                            loadingIndicator.textContent = 'æ­£åœ¨æ’­æ”¾åŠ¨ç”»...';
                        }
                        
                        // å¼€å§‹å¾ªç¯æ’­æ”¾è§†é¢‘
                        playVideoLoop(videoSrc);
                    } else {
                        console.log(`âœ— æœªæ‰¾åˆ°è§†é¢‘æ–‡ä»¶: ${videoSrc}`);
                        // å¯ç”¨æ¼”ç¤ºæ¨¡å¼
                        enableDemoMode();
                    }
                } catch (error) {
                    console.log(`æ£€æµ‹è§†é¢‘å¤±è´¥: ${videoSrc}`, error);
                    enableDemoMode();
                }
            }
            
            // å¾ªç¯æ’­æ”¾è§†é¢‘çš„å‡½æ•° - ç®€åŒ–ç‰ˆ
            function playVideoLoop(videoSrc) {
                console.log(`å¼€å§‹å¾ªç¯æ’­æ”¾è§†é¢‘: ${videoSrc}`);
                
                // æœ€ç»ˆå®‰å…¨æ£€æŸ¥ - ç¡®ä¿ä¸ä¼šåŠ è½½é”™è¯¯çš„æ–‡ä»¶
                if (videoSrc.includes('intro') || !videoSrc.includes('animation.mp4')) {
                    console.error('âŒ ä¸¥é‡è­¦å‘Š: playVideoLoopæ”¶åˆ°äº†é”™è¯¯çš„è§†é¢‘è·¯å¾„:', videoSrc);
                    console.error('âŒ æ‹’ç»æ’­æ”¾ï¼Œå¯ç”¨æ¼”ç¤ºæ¨¡å¼');
                    enableDemoMode();
                    return;
                }
                
                // æ¸…é™¤videoå…ƒç´ çš„ä»»ä½•ç°æœ‰çŠ¶æ€
                introVideo.pause();
                introVideo.src = '';
                introVideo.load(); // é‡ç½®
                
                // è®¾ç½®è§†é¢‘æº
                introVideo.src = videoSrc;
                introVideo.currentTime = 0;
                introVideo.loop = true; // å¼€å¯å¾ªç¯æ’­æ”¾
                introVideo.muted = true; // ç¡®ä¿èƒ½è‡ªåŠ¨æ’­æ”¾
                introVideo.autoplay = true; // å°è¯•è‡ªåŠ¨æ’­æ”¾
                
                // ç®€åŒ–çš„äº‹ä»¶å¤„ç†
                introVideo.onloadedmetadata = function() {
                    console.log(`è§†é¢‘å…ƒæ•°æ®åŠ è½½æˆåŠŸ: ${videoSrc}ï¼Œæ—¶é•¿: ${introVideo.duration}ç§’`);
                    
                    // ç«‹å³å°è¯•æ’­æ”¾
                    introVideo.play().then(() => {
                        console.log('âœ“ å¼€å§‹æ’­æ”¾:', videoSrc);
                        
                        // 5ç§’åæ˜¾ç¤ºè¿›å…¥æŒ‰é’®
                        setTimeout(() => {
                            console.log('è§†é¢‘å·²æ’­æ”¾è¶³å¤Ÿæ—¶é—´ï¼Œæ˜¾ç¤ºè¿›å…¥æŒ‰é’®');
                            showTitleAndButton();
                        }, 5000);
                        
                    }).catch(error => {
                        console.log('âš ï¸ è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨äº¤äº’:', error);
                        // æ˜¾ç¤ºä¸€ä¸ªæç¤ºè®©ç”¨æˆ·ç‚¹å‡»æ’­æ”¾
                        setTimeout(() => {
                            showTitleAndButton();
                        }, 2000);
                    });
                };
                
                introVideo.onerror = function(error) {
                    console.log(`âœ— è§†é¢‘æ’­æ”¾å‡ºé”™: ${videoSrc}`, error);
                    setTimeout(() => {
                        enableDemoMode();
                    }, 1000);
                };
                
                // æ‰‹åŠ¨è§¦å‘åŠ è½½
                introVideo.load();
                
                // å¼€å§‹æ’­æ”¾
                introVideo.play().then(() => {
                    console.log(`âœ“ å¼€å§‹å¾ªç¯æ’­æ”¾: ${videoSrc}`);
                }).catch(error => {
                    console.log(`âœ— æ’­æ”¾å¯åŠ¨å¤±è´¥: ${videoSrc}`, error);
                    setTimeout(() => {
                        enableDemoMode();
                    }, 1000);
                });
            }
            
            // å¯ç”¨æ¼”ç¤ºæ¨¡å¼
            function enableDemoMode() {
                console.log('âš ï¸ å¯ç”¨æ¼”ç¤ºæ¨¡å¼ - æœªæ£€æµ‹åˆ°animation.mp4æ–‡ä»¶');
                demoModeActive = true;
                
                if (loadingIndicator) {
                    loadingIndicator.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; margin-bottom: 10px;">ğŸ§¬ ç»†èƒç»“æ„3Då¯è§†åŒ–å¹³å°</div>
                            <div style="font-size: 0.9em; opacity: 0.8;">æ–‡ä»¶ç¼ºå¤±ï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼</div>
                            <div style="font-size: 0.8em; opacity: 0.6; margin-top: 5px;">
                                ç¼ºå°‘: animation.mp4, cell_model1/<br>
                                ğŸ”¬ BioDigital APIå·²é…ç½®
                            </div>
                            <div style="width: 100%; height: 2px; background: rgba(255,255,255,0.3); margin: 20px 0; border-radius: 1px; overflow: hidden;">
                                <div style="width: 0%; height: 100%; background: linear-gradient(90deg, #4ECDC4, #44A08D); border-radius: 1px; animation: loadingBar 2s ease-in-out forwards;"></div>
                            </div>
                        </div>
                        <style>
                            @keyframes loadingBar {
                                0% { width: 0%; }
                                50% { width: 70%; }
                                100% { width: 100%; }
                            }
                        </style>
                    `;
                }
                
                // ç¼©çŸ­ç­‰å¾…æ—¶é—´åˆ°2ç§’
                setTimeout(() => {
                    console.log('âš ï¸ æ¼”ç¤ºæ¨¡å¼å»¶æ—¶å®Œæˆï¼Œæ˜¾ç¤ºä¸»ç•Œé¢æŒ‰é’®');
                    allVideosPlayed = true;
                    showTitleAndButton();
                }, 2000);
            }
            
            // æ£€æµ‹è§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨ - å¢å¼ºç‰ˆ
            async function checkVideoExists(videoSrc) {
                console.log(`å¼€å§‹æ£€æµ‹è§†é¢‘æ–‡ä»¶: ${videoSrc}`);
                
                // å®‰å…¨æ£€æŸ¥ - ç»ä¸æ£€æµ‹introå¼€å¤´çš„æ–‡ä»¶
                if (videoSrc.includes('intro') && !videoSrc.includes('animation.mp4')) {
                    console.error('âŒ æ‹’ç»æ£€æµ‹introç±»æ–‡ä»¶:', videoSrc);
                    return false;
                }
                
                try {
                    // ç”Ÿæˆå®Œæ•´URL
                    const fullUrl = new URL(videoSrc, window.location.href);
                    console.log(`å®Œæ•´è§†é¢‘URL: ${fullUrl.href}`);
                    
                    // ä½¿ç”¨HEADè¯·æ±‚æ£€æµ‹æ–‡ä»¶ï¼Œå¼ºåˆ¶åˆ·æ–°ç¼“å­˜
                    const response = await fetch(videoSrc, { 
                        method: 'HEAD',
                        cache: 'no-cache',
                        headers: {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        }
                    });
                    
                    if (response.ok) {
                        console.log(`âœ“ è§†é¢‘æ–‡ä»¶å­˜åœ¨: ${videoSrc} (çŠ¶æ€: ${response.status})`);
                        return true;
                    } else {
                        console.log(`âœ— è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨: ${videoSrc} (çŠ¶æ€: ${response.status})`);
                        return false;
                    }
                } catch (error) {
                    console.log(`âœ— æ£€æµ‹è§†é¢‘æ–‡ä»¶å¤±è´¥: ${videoSrc}`, error.message);
                    return false;
                }
            }
            
            // æ˜¾ç¤ºæ ‡é¢˜å’Œè¿›å…¥æŒ‰é’®
            function showTitleAndButton() {
                console.log('æ‰€æœ‰è§†é¢‘æ’­æ”¾å®Œæ¯•ï¼Œæ˜¾ç¤ºæ ‡é¢˜å’ŒæŒ‰é’®');
                
                // éšè—åŠ è½½æç¤º
                if (loadingIndicator) {
                    loadingIndicator.style.opacity = '0';
                    setTimeout(() => {
                        loadingIndicator.style.display = 'none';
                    }, 500);
                }
                
                // æš‚åœè§†é¢‘
                introVideo.pause();
                
                // æ˜¾ç¤ºæ ‡é¢˜å’ŒæŒ‰é’®ï¼ˆæ·»åŠ æ¸ç°æ•ˆæœï¼‰
                setTimeout(() => {
                    platformTitle.classList.add('show');
                    setTimeout(() => {
                        enterButton.classList.add('show');
                    }, 800);
                }, 1000);
            }
            
            // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æ’­æ”¾è§†é¢‘
            window.addEventListener('load', function() {
                console.log('=== é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ’­æ”¾åŠ¨ç”» ===');
                console.log('å½“å‰é¡µé¢å®Œæ•´URL:', window.location.href);
                console.log('å½“å‰é¡µé¢è·¯å¾„:', window.location.pathname);
                console.log('å½“å‰é¡µé¢ç›®å½•:', window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/')));
                console.log('å½“å‰HTMLæ–‡ä»¶å:', window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1));
                
                // æ ¹æ®æ‚¨æä¾›çš„è·¯å¾„ä¿¡æ¯ï¼š
                // HTML: D:\å­¦ä¹ èµ„æ–™\å¾®ç”Ÿç‰©å­¦\Cell_Compare\deepseek_html_20250625_795aa2.html
                // è§†é¢‘: D:\å­¦ä¹ èµ„æ–™\å¾®ç”Ÿç‰©å­¦\Cell_Compare\animation\animation.mp4
                // æ¨¡å‹: D:\å­¦ä¹ èµ„æ–™\å¾®ç”Ÿç‰©å­¦\Cell_Compare\cell_model1\*
                // ä½¿ç”¨ç›¸å¯¹è·¯å¾„: animation/animation.mp4 å’Œ cell_model1/*
                
                loadAndPlayNextVideo();
                
                // è¶…æ—¶ä¿æŠ¤ï¼šå¦‚æœ8ç§’å†…æ²¡æœ‰æˆåŠŸæ’­æ”¾å°±æ˜¾ç¤ºæŒ‰é’®
                setTimeout(() => {
                    if (!allVideosPlayed) {
                        console.log('â° 8ç§’è¶…æ—¶ä¿æŠ¤ï¼šå¼ºåˆ¶æ˜¾ç¤ºä¸»ç•Œé¢æŒ‰é’®');
                        allVideosPlayed = true;
                        showTitleAndButton();
                    }
                }, 8000);
            });
            
            // å…¨å±€çŠ¶æ€å˜é‡
            let allVideosPlayed = false;
            let demoModeActive = false;
            
            // è¿›å…¥ä¸»ç•Œé¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            enterButton.addEventListener('click', function() {
                videoContainer.style.opacity = '0';
                videoContainer.style.transform = 'scale(1.1)';
                
                setTimeout(() => {
                    videoContainer.style.display = 'none';
                    mainContainer.style.display = 'flex';
                    mainContainer.style.opacity = '0';
                    
                    // æ·¡å…¥ä¸»ç•Œé¢
                    setTimeout(() => {
                        mainContainer.style.transition = 'opacity 1s ease';
                        mainContainer.style.opacity = '1';
                        init3DViewer();
                    }, 100);
                }, 500);
            });
        });
        
        // 3Dåœºæ™¯åˆå§‹åŒ–
        function init3DViewer() {
            const container = document.getElementById('render-container');
            
            // åœºæ™¯è®¾ç½®
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x95D4F3); // ä½¿ç”¨æ–°çš„é…è‰²æ–¹æ¡ˆ
            
            // ç›¸æœºè®¾ç½®
            const camera = new THREE.PerspectiveCamera(75, (container.clientWidth - 300) / container.clientHeight, 0.1, 1000);
            camera.position.z = 30;
            camera.position.y = 10;
            
            // æ¸²æŸ“å™¨è®¾ç½®
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // æ§åˆ¶å™¨è®¾ç½®
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // å…‰æºè®¾ç½® - å¢å¼ºç…§æ˜æ•ˆæœ
            const ambientLight = new THREE.AmbientLight(0xF9F2E0, 0.6);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0x3DA4E6, 1.0);
            directionalLight1.position.set(10, 10, 5);
            directionalLight1.castShadow = true;
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0x1660AB, 0.7);
            directionalLight2.position.set(-10, -5, -5);
            scene.add(directionalLight2);
            
            // æ·»åŠ ç‚¹å…‰æºä»¥å¢å¼ºè§†è§‰æ•ˆæœ
            const pointLight = new THREE.PointLight(0x95D4F3, 0.8, 100);
            pointLight.position.set(0, 15, 10);
            scene.add(pointLight);
            
            // å­˜å‚¨æ‰€æœ‰å¯äº¤äº’çš„éƒ¨åˆ†
            const cellParts = {
                prokaryotic: {},
                eukaryotic: {}
            };
            
            // å­˜å‚¨é«˜äº®æè´¨
            const highlightMaterials = new Map();
            let currentHighlighted = null;
            
            // åˆ›å»º3Dæ–‡å­—æ ‡ç­¾
            function createTextLabel(text, position) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 64;
                
                // ä½¿ç”¨æ¸å˜èƒŒæ™¯
                const gradient = context.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#F9F2E0');
                gradient.addColorStop(1, '#E2E7BF');
                
                context.fillStyle = gradient;
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                // æ·»åŠ è¾¹æ¡†
                context.strokeStyle = '#1660AB';
                context.lineWidth = 3;
                context.strokeRect(0, 0, canvas.width, canvas.height);
                
                // æ·»åŠ æ–‡å­—
                context.fillStyle = '#2B313F';
                context.font = 'bold 24px Arial';
                context.textAlign = 'center';
                context.shadowColor = 'rgba(166, 27, 41, 0.3)';
                context.shadowBlur = 4;
                context.shadowOffsetX = 2;
                context.shadowOffsetY = 2;
                context.fillText(text, canvas.width / 2, canvas.height / 2 + 8);
                
                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(material);
                sprite.position.copy(position);
                sprite.scale.set(8, 2, 1);
                
                return sprite;
            }
            
            // åˆ›å»ºç»†èƒæ¨¡å‹
            const cells = {
                prokaryotic: createProkaryoticCell(),
                eukaryotic: createEukaryoticCell()
            };
            
            // å°†ç»†èƒæ¨¡å‹æ·»åŠ åˆ°åœºæ™¯
            // ä¸æ·»åŠ åŸæ ¸ç»†èƒåˆ°åœºæ™¯ï¼Œè€Œæ˜¯ç”¨BioDigitalæ¨¡å‹æ›¿ä»£
            // cells.prokaryotic.position.x = -15;
            // scene.add(cells.prokaryotic);
            
            // ä½¿ç”¨BioDigitalæ¨¡å‹æ›¿ä»£åŸæ ¸ç»†èƒï¼ˆå·¦ä¾§ä½ç½®ï¼‰
            const biodigitalContainer = document.createElement('div');
            biodigitalContainer.id = 'biodigital-prokaryotic-cell';
            biodigitalContainer.style.cssText = `
                position: absolute;
                left: 100px;
                top: 120px;
                width: 480px;
                height: 480px;
                border: 2px solid rgba(249, 242, 224, 0.3);
                border-radius: 16px;
                overflow: hidden;
                background: linear-gradient(135deg, rgba(9, 55, 92, 0.1), rgba(166, 27, 41, 0.05));
                z-index: 10;
                box-shadow: 
                    0 12px 40px rgba(9, 55, 92, 0.3),
                    inset 0 1px 0 rgba(249, 242, 224, 0.2);
                backdrop-filter: blur(5px);
            `;
            
            // åˆ›å»ºiframeï¼ˆå®˜æ–¹æ¨èæ–¹å¼ï¼‰
            const iframe = document.createElement('iframe');
            iframe.id = 'biodigital-widget';
            // ä½¿ç”¨ç»è¿‡éªŒè¯çš„ç»†èƒæ¨¡å‹ID - ç¡®ä¿æ¨¡å‹å­˜åœ¨ä¸”å¯è®¿é—®
            iframe.src = `https://human.biodigital.com/widget/?m=maleAdult&dk=0e068cfbbba1de0aef62cb0f88efc977de83ff6f&ui-info=false&ui-fullscreen=false&ui-help=false&ui-layers=false&ui-search=false&ui-menu=false&ui-tools=false&ui-labels=false&background=transparent`;
            iframe.style.cssText = `
                width: 100%;
                height: 100%;
                border: none;
                border-radius: 14px;
                background: transparent;
            `;
            biodigitalContainer.appendChild(iframe);
            
            // æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'biodigital-loading';
            loadingDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: #F9F2E0;
                font-size: 16px;
                z-index: 20;
                text-align: center;
                background: rgba(9, 55, 92, 0.8);
                padding: 20px;
                border-radius: 8px;
                backdrop-filter: blur(5px);
            `;
            loadingDiv.innerHTML = `
                <div style="margin-bottom: 10px;">ğŸ”¬ åŠ è½½BioDigitalç»†èƒæ¨¡å‹</div>
                <div style="font-size: 12px; opacity: 0.8;">è¯·ç¨å€™...</div>
            `;
            biodigitalContainer.appendChild(loadingDiv);
            
            // ç­‰å¾…iframeåŠ è½½åéšè—åŠ è½½æŒ‡ç¤ºå™¨
            iframe.addEventListener('load', () => {
                setTimeout(() => {
                    loadingDiv.style.display = 'none';
                }, 1000);
            });
            
            // æ·»åŠ åˆ°åœºæ™¯å®¹å™¨
            container.appendChild(biodigitalContainer);
            
            // ç­‰å¾…iframeåŠ è½½å®Œæˆååˆå§‹åŒ–API
            iframe.onload = function() {
                // ç­‰å¾…HumanAPIè„šæœ¬å®Œå…¨åŠ è½½
                function initBioDigitalAPI() {
                    if (typeof HumanAPI !== 'undefined') {
                        try {
                            window.humanAPI = new HumanAPI("biodigital-widget");
                            console.log('âœ… BioDigital HumanAPI åˆå§‹åŒ–æˆåŠŸï¼');
                            
                            // ç­‰å¾…æ›´é•¿æ—¶é—´ç¡®ä¿æ¨¡å‹å®Œå…¨åŠ è½½
                            setTimeout(() => {
                                if (window.humanAPI) {
                                    try {
                                        window.humanAPI.send("timeline.pause");
                                        window.humanAPI.send("camera.set", {
                                            position: { x: 0, y: 0, z: -50 },
                                            target: { x: 0, y: 0, z: 0 },
                                            animate: true
                                        });
                                        window.humanAPI.send("scene.set", {
                                            background: { r: 0.58, g: 0.83, b: 0.95, a: 0.1 } // é€æ˜èƒŒæ™¯
                                        });
                                        console.log('ğŸ”¬ BioDigitalæ¨¡å‹å·²é…ç½®ä¸ºç»†èƒå±•ç¤ºæ¨¡å¼');
                                    } catch (configError) {
                                        console.log('âš ï¸ BioDigitalé…ç½®å¤±è´¥ï¼ˆæ¨¡å‹ä»å¯ç”¨ï¼‰:', configError);
                                    }
                                }
                            }, 3000);
                            
                        } catch (error) {
                            console.error('âŒ BioDigital HumanAPI åˆå§‹åŒ–å¤±è´¥:', error);
                            fallbackToThreeJS();
                        }
                    } else {
                        // HumanAPIè¿˜æ²¡åŠ è½½ï¼Œç¨åé‡è¯•
                        console.log('â³ ç­‰å¾…HumanAPIè„šæœ¬åŠ è½½...');
                        setTimeout(initBioDigitalAPI, 500);
                    }
                }
                
                // å¼€å§‹åˆå§‹åŒ–
                initBioDigitalAPI();
            };
            
            // iframeåŠ è½½å¤±è´¥çš„å¤„ç†
            iframe.onerror = function() {
                console.error('âŒ BioDigital iframeåŠ è½½å¤±è´¥');
                fallbackToThreeJS();
            };
            
            // iframeç½‘ç»œé”™è¯¯çš„é¢å¤–ç›‘å¬
            iframe.addEventListener('error', function() {
                console.error('âŒ BioDigitalæ¨¡å‹åŠ è½½é”™è¯¯');
                fallbackToThreeJS();
            });
            
            // è¶…æ—¶ä¿æŠ¤ - å¦‚æœ3ç§’å†…æ²¡æœ‰æˆåŠŸåŠ è½½å°±ä½¿ç”¨å¤‡ç”¨æ¨¡å‹
            setTimeout(() => {
                if (!window.humanAPI) {
                    console.log('â° BioDigitalåŠ è½½è¶…æ—¶ï¼Œä½¿ç”¨å¤‡ç”¨æ¨¡å‹');
                    fallbackToThreeJS();
                }
            }, 3000);
            
            // å¤‡ç”¨æ–¹æ¡ˆå‡½æ•°
            function fallbackToThreeJS() {
                cells.prokaryotic.position.x = -15;
                scene.add(cells.prokaryotic);
                biodigitalContainer.style.display = 'none';
                console.log('ğŸ”„ ä½¿ç”¨å¤‡ç”¨Three.jsåŸæ ¸ç»†èƒæ¨¡å‹');
            }
            
            // åŸæ¥çš„Three.jsçœŸæ ¸ç»†èƒæ¨¡å‹ï¼ˆå¤‡ç”¨ï¼‰
            cells.eukaryotic.position.x = 15;
            cells.eukaryotic.visible = false; // éšè—åŸæ¨¡å‹
            scene.add(cells.eukaryotic);
            
            // åˆ›å»º3Dæ ‡ç­¾
            const prokaryoticLabel = createTextLabel('åŸæ ¸ç»†èƒ (BioDigital)', new THREE.Vector3(-15, 12, 0));
            const eukaryoticLabel = createTextLabel('çœŸæ ¸ç»†èƒ', new THREE.Vector3(15, 12, 0));
            scene.add(prokaryoticLabel);
            scene.add(eukaryoticLabel);
            
            // é«˜äº®åŠŸèƒ½
            function highlightPart(cellType, partName) {
                // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                clearHighlight();
                
                if (cellParts[cellType] && cellParts[cellType][partName]) {
                    const part = cellParts[cellType][partName];
                    currentHighlighted = { cellType, partName, part };
                    
                    if (part instanceof THREE.Group) {
                        part.children.forEach(child => {
                            if (child.material) {
                                const originalMaterial = child.material;
                                const highlightMaterial = originalMaterial.clone();
                                // ä½¿ç”¨æ–°é…è‰²çš„å‘å…‰æ•ˆæœ
                                highlightMaterial.emissive = new THREE.Color(0xA61B29);
                                highlightMaterial.emissiveIntensity = 0.3;
                                highlightMaterials.set(child, originalMaterial);
                                child.material = highlightMaterial;
                            }
                        });
                    } else if (part.material) {
                        const originalMaterial = part.material;
                        const highlightMaterial = originalMaterial.clone();
                        highlightMaterial.emissive = new THREE.Color(0xA61B29);
                        highlightMaterial.emissiveIntensity = 0.3;
                        highlightMaterials.set(part, originalMaterial);
                        part.material = highlightMaterial;
                    }
                }
            }
            
            function clearHighlight() {
                if (currentHighlighted) {
                    highlightMaterials.forEach((originalMaterial, object) => {
                        object.material = originalMaterial;
                    });
                    highlightMaterials.clear();
                    currentHighlighted = null;
                }
            }
            
// åˆ›å»ºåŸæ ¸ç»†èƒ - ä½¿ç”¨å¤–éƒ¨3Dæ¨¡å‹
function createProkaryoticCell() {
    const group = new THREE.Group();
    
    // åˆ›å»ºä¸€ä¸ªåŠ è½½ä¸­çš„å ä½ç¬¦
    const placeholderGeometry = new THREE.SphereGeometry(5, 16, 16);
    const placeholderMaterial = new THREE.MeshPhongMaterial({ 
        color: 0x888888, 
        transparent: true, 
        opacity: 0.3,
        wireframe: true 
    });
    const placeholder = new THREE.Mesh(placeholderGeometry, placeholderMaterial);
    group.add(placeholder);
    
    // æ·»åŠ åŠ è½½æ–‡æœ¬
    const loader = new THREE.FontLoader();
    
    // åˆ›å»ºç®€å•çš„æ–‡æœ¬æ ‡è¯†
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    canvas.width = 256;
    canvas.height = 64;
    
    context.fillStyle = '#333333';
    context.fillRect(0, 0, canvas.width, canvas.height);
    
    context.fillStyle = '#ffffff';
    context.font = 'bold 20px Arial';
    context.textAlign = 'center';
    context.fillText('æ­£åœ¨åŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹...', canvas.width / 2, canvas.height / 2 + 7);
    
    const texture = new THREE.CanvasTexture(canvas);
    const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
    const sprite = new THREE.Sprite(spriteMaterial);
    sprite.position.set(0, 8, 0);
    sprite.scale.set(8, 2, 1);
    group.add(sprite);
    
    // ä½¿ç”¨GLTFLoaderå’ŒOBJLoaderåŠ è½½å¤–éƒ¨æ¨¡å‹
    const gltfLoader = new THREE.GLTFLoader();
    const objLoader = new THREE.OBJLoader();
    
    // å°è¯•åŠ è½½ä¸åŒçš„å¯èƒ½æ–‡ä»¶æ ¼å¼
    const possibleModels = [
        { path: 'cell_model1/model.obj', type: 'obj' },
        { path: 'cell_model1/model.gltf', type: 'gltf' },
        { path: 'cell_model1/model.glb', type: 'gltf' },
        { path: 'cell_model1/prokaryotic_cell.obj', type: 'obj' },
        { path: 'cell_model1/prokaryotic_cell.gltf', type: 'gltf' },
        { path: 'cell_model1/prokaryotic_cell.glb', type: 'gltf' },
        { path: 'cell_model1/prokaryotic.obj', type: 'obj' },
        { path: 'cell_model1/prokaryotic.gltf', type: 'gltf' },
        { path: 'cell_model1/prokaryotic.glb', type: 'gltf' }
    ];
    
    let modelLoaded = false;
    
    function tryLoadModel(modelIndex = 0) {
        if (modelIndex >= possibleModels.length) {
            console.log('âš ï¸ æœªæ‰¾åˆ°å¯ç”¨çš„åŸæ ¸ç»†èƒæ¨¡å‹ï¼Œä½¿ç”¨å†…ç½®æ¨¡å‹');
            // ç§»é™¤å ä½ç¬¦å’ŒåŠ è½½æ–‡æœ¬
            group.remove(placeholder);
            group.remove(sprite);
            // åˆ›å»ºç®€åŒ–çš„å†…ç½®æ¨¡å‹
            createFallbackProkaryoticCell(group);
            return;
        }
        
        const modelInfo = possibleModels[modelIndex];
        const modelPath = modelInfo.path;
        console.log(`å°è¯•åŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹: ${modelPath} (ç±»å‹: ${modelInfo.type})`);
        
        // æ›´æ–°åŠ è½½æ–‡æœ¬
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = '#333333';
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = '#ffffff';
        context.fillText(`åŠ è½½æ¨¡å‹ ${modelIndex + 1}/${possibleModels.length}...`, canvas.width / 2, canvas.height / 2 + 7);
        texture.needsUpdate = true;
        
        // æ ¹æ®æ¨¡å‹ç±»å‹é€‰æ‹©åŠ è½½å™¨
        if (modelInfo.type === 'gltf') {
            gltfLoader.load(
                modelPath,
            function(gltf) {
                console.log(`âœ“ æˆåŠŸåŠ è½½åŸæ ¸ç»†èƒæ¨¡å‹: ${modelPath}`);
                modelLoaded = true;
                
                // ç§»é™¤å ä½ç¬¦
                group.remove(placeholder);
                group.remove(sprite);
                
                // æ·»åŠ åŠ è½½çš„æ¨¡å‹
                const model = gltf.scene;
                
                // è°ƒæ•´æ¨¡å‹å¤§å°å’Œä½ç½®
                const box = new THREE.Box3().setFromObject(model);
                const size = box.getSize(new THREE.Vector3());
                const center = box.getCenter(new THREE.Vector3());
                
                // ç¼©æ”¾æ¨¡å‹ä½¿å…¶é€‚åˆåœºæ™¯
                const maxSize = Math.max(size.x, size.y, size.z);
                const targetSize = 10; // ç›®æ ‡å¤§å°
                const scale = targetSize / maxSize;
                model.scale.setScalar(scale);
                
                // å±…ä¸­æ¨¡å‹
                model.position.sub(center.multiplyScalar(scale));
                
                // åº”ç”¨æè´¨å¢å¼º
                model.traverse(function(child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        
                        // å¢å¼ºæè´¨
                        if (child.material) {
                            child.material.needsUpdate = true;
                            
                            // ä¸ºä¸åŒéƒ¨åˆ†è®¾ç½®ä¸åŒçš„æè´¨å±æ€§
                            if (child.name.toLowerCase().includes('membrane') || 
                                child.name.toLowerCase().includes('è†œ')) {
                                child.material.transparent = true;
                                child.material.opacity = 0.7;
                                child.material.color.setHex(0x00aa00);
                                cellParts.prokaryotic.cellMembrane = child;
                            } else if (child.name.toLowerCase().includes('wall') || 
                                      child.name.toLowerCase().includes('å£')) {
                                child.material.transparent = true;
                                child.material.opacity = 0.5;
                                child.material.color.setHex(0xcccccc);
                                cellParts.prokaryotic.cellWall = child;
                            } else if (child.name.toLowerCase().includes('nucleoid') || 
                                      child.name.toLowerCase().includes('æ ¸')) {
                                child.material.color.setHex(0x0000aa);
                                cellParts.prokaryotic.nucleoid = child;
                            } else if (child.name.toLowerCase().includes('ribosome') || 
                                      child.name.toLowerCase().includes('æ ¸ç³–ä½“')) {
                                child.material.color.setHex(0x555555);
                                cellParts.prokaryotic.ribosomes = child;
                            }
                        }
                    }
                });
                
                group.add(model);
                console.log('åŸæ ¸ç»†èƒæ¨¡å‹åŠ è½½å®Œæˆ');
            },
            function(progress) {
                console.log(`åŠ è½½è¿›åº¦: ${modelPath} - ${(progress.loaded / progress.total * 100)}%`);
            },
            function(error) {
                console.log(`âœ— åŠ è½½GLTFæ¨¡å‹å¤±è´¥: ${modelPath}`, error);
                // å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
                setTimeout(() => tryLoadModel(modelIndex + 1), 100);
            }
        );
        } else if (modelInfo.type === 'obj') {
            // ä½¿ç”¨OBJåŠ è½½å™¨
            objLoader.load(
                modelPath,
                function(object) {
                    console.log(`âœ“ æˆåŠŸåŠ è½½åŸæ ¸ç»†èƒOBJæ¨¡å‹: ${modelPath}`);
                    modelLoaded = true;
                    
                    // ç§»é™¤å ä½ç¬¦
                    group.remove(placeholder);
                    group.remove(sprite);
                    
                    // è°ƒæ•´æ¨¡å‹å¤§å°å’Œä½ç½®
                    const box = new THREE.Box3().setFromObject(object);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());
                    
                    // ç¼©æ”¾æ¨¡å‹ä½¿å…¶é€‚åˆåœºæ™¯
                    const maxSize = Math.max(size.x, size.y, size.z);
                    const targetSize = 10; // ç›®æ ‡å¤§å°
                    const scale = targetSize / maxSize;
                    object.scale.setScalar(scale);
                    
                    // å±…ä¸­æ¨¡å‹
                    object.position.sub(center.multiplyScalar(scale));
                    
                    // åº”ç”¨é»˜è®¤æè´¨
                    object.traverse(function(child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // å¦‚æœæ²¡æœ‰æè´¨ï¼Œæ·»åŠ é»˜è®¤æè´¨
                            if (!child.material) {
                                child.material = new THREE.MeshPhongMaterial({ 
                                    color: 0x88ccff,
                                    transparent: true,
                                    opacity: 0.8
                                });
                            }
                        }
                    });
                    
                    group.add(object);
                    console.log('åŸæ ¸ç»†èƒOBJæ¨¡å‹åŠ è½½å®Œæˆ');
                },
                function(progress) {
                    console.log(`OBJåŠ è½½è¿›åº¦: ${modelPath}`);
                },
                function(error) {
                    console.log(`âœ— åŠ è½½OBJæ¨¡å‹å¤±è´¥: ${modelPath}`, error);
                    // å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
                    setTimeout(() => tryLoadModel(modelIndex + 1), 100);
                }
            );
        }
    }
    
    // å¼€å§‹åŠ è½½æ¨¡å‹
    tryLoadModel();
    
    return group;
}

// åˆ›å»ºå¤‡ç”¨çš„åŸæ ¸ç»†èƒæ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
function createFallbackProkaryoticCell(group) {
    console.log('åˆ›å»ºå¤‡ç”¨åŸæ ¸ç»†èƒæ¨¡å‹');
    
    // ç»†èƒè´¨åŸºè´¨ï¼ˆåŠé€æ˜ï¼‰
    const cytoplasmGeometry = new THREE.SphereGeometry(6, 32, 32);
    const cytoplasmMaterial = new THREE.MeshPhongMaterial({
        color: 0xffe4b5,
        transparent: true,
        opacity: 0.3
    });
    const cytoplasm = new THREE.Mesh(cytoplasmGeometry, cytoplasmMaterial);
    group.add(cytoplasm);
    cellParts.prokaryotic.cytoplasm = cytoplasm;

    // ç»†èƒè†œ
    const cellMembraneGeometry = new THREE.SphereGeometry(6.2, 32, 32);
    const cellMembraneMaterial = new THREE.MeshPhongMaterial({
        color: 0x00aa00,
        transparent: true,
        opacity: 0.7,
        side: THREE.DoubleSide
    });
    const cellMembrane = new THREE.Mesh(cellMembraneGeometry, cellMembraneMaterial);
    group.add(cellMembrane);
    cellParts.prokaryotic.cellMembrane = cellMembrane;

    // ç»†èƒå£
    const cellWallGeometry = new THREE.SphereGeometry(6.5, 32, 32);
    const cellWallMaterial = new THREE.MeshPhongMaterial({
        color: 0xcccccc,
        transparent: true,
        opacity: 0.5,
        side: THREE.DoubleSide
    });
    const cellWall = new THREE.Mesh(cellWallGeometry, cellWallMaterial);
    group.add(cellWall);
    cellParts.prokaryotic.cellWall = cellWall;

    // æ‹Ÿæ ¸
    const nucleoidGeometry = new THREE.TorusKnotGeometry(1.5, 0.2, 100, 16);
    const nucleoidMaterial = new THREE.MeshPhongMaterial({ 
        color: 0x0000aa, 
        transparent: true, 
        opacity: 0.7 
    });
    const nucleoid = new THREE.Mesh(nucleoidGeometry, nucleoidMaterial);
    nucleoid.position.set(0, 0, 0);
    group.add(nucleoid);
    cellParts.prokaryotic.nucleoid = nucleoid;

    // æ ¸ç³–ä½“ç¾¤
    const ribosomesGroup = new THREE.Group();
    for (let i = 0; i < 20; i++) {
        const ribosomeGeometry = new THREE.SphereGeometry(0.15, 8, 8);
        const ribosomeMaterial = new THREE.MeshPhongMaterial({ color: 0x555555 });
        const ribosome = new THREE.Mesh(ribosomeGeometry, ribosomeMaterial);

        const theta = Math.random() * Math.PI * 2;
        const phi = Math.random() * Math.PI;
        const radius = 3 + Math.random() * 2;

        ribosome.position.set(
            radius * Math.sin(phi) * Math.cos(theta),
            radius * Math.sin(phi) * Math.sin(theta),
            radius * Math.cos(phi)
        );

        ribosomesGroup.add(ribosome);
    }
    group.add(ribosomesGroup);
    cellParts.prokaryotic.ribosomes = ribosomesGroup;
}

// åˆ›å»ºçœŸæ ¸ç»†èƒ
function createEukaryoticCell() {
                const group = new THREE.Group();
                
                // ç»†èƒè´¨åŸºè´¨ï¼ˆåŠé€æ˜ï¼‰
                const cytoplasmGeometry = new THREE.SphereGeometry(8, 32, 32);
                const cytoplasmMaterial = new THREE.MeshPhongMaterial({
                    color: 0x88ccff,
                    transparent: true,
                    opacity: 0.3
                });
                const cytoplasm = new THREE.Mesh(cytoplasmGeometry, cytoplasmMaterial);
                group.add(cytoplasm);
                cellParts.eukaryotic.cytoplasm = cytoplasm;
                
                // ç»†èƒè†œ
                const cellMembraneGeometry = new THREE.SphereGeometry(8.2, 32, 32);
                const cellMembraneMaterial = new THREE.MeshPhongMaterial({
                    color: 0x00aa00,
                    transparent: true,
                    opacity: 0.7,
                    side: THREE.DoubleSide
                });
                const cellMembrane = new THREE.Mesh(cellMembraneGeometry, cellMembraneMaterial);
                group.add(cellMembrane);
                cellParts.eukaryotic.cellMembrane = cellMembrane;
                
                // æ¤ç‰©ç»†èƒå£ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
                const plantCellWallGeometry = new THREE.SphereGeometry(8.4, 32, 32);
                const plantCellWallMaterial = new THREE.MeshPhongMaterial({
                    color: 0x90EE90,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.DoubleSide
                });
                const plantCellWall = new THREE.Mesh(plantCellWallGeometry, plantCellWallMaterial);
                group.add(plantCellWall);
                cellParts.eukaryotic.cellWall = plantCellWall;
                
                // ç»†èƒæ ¸
                const nucleusGeometry = new THREE.SphereGeometry(2.5, 32, 32);
                const nucleusMaterial = new THREE.MeshPhongMaterial({
                    color: 0xaa0000,
                    transparent: true,
                    opacity: 0.7
                });
                const nucleus = new THREE.Mesh(nucleusGeometry, nucleusMaterial);
                nucleus.position.set(0, 0, 0);
                group.add(nucleus);
                cellParts.eukaryotic.nucleus = nucleus;
                
                // æ ¸è†œ
                const nuclearMembraneGeometry = new THREE.SphereGeometry(2.7, 32, 32);
                const nuclearMembraneMaterial = new THREE.MeshPhongMaterial({
                    color: 0x00aa00,
                    transparent: true,
                    opacity: 0.5,
                    side: THREE.DoubleSide
                });
                const nuclearMembrane = new THREE.Mesh(nuclearMembraneGeometry, nuclearMembraneMaterial);
                group.add(nuclearMembrane);
                cellParts.eukaryotic.nuclearMembrane = nuclearMembrane;
                
                // æ ¸ä»
                const nucleolusGeometry = new THREE.SphereGeometry(0.8, 16, 16);
                const nucleolusMaterial = new THREE.MeshPhongMaterial({ color: 0xdd0000 });
                const nucleolus = new THREE.Mesh(nucleolusGeometry, nucleolusMaterial);
                nucleolus.position.set(1, 0.5, 0.5);
                nucleus.add(nucleolus);
                cellParts.eukaryotic.nucleolus = nucleolus;
                
                // çº¿ç²’ä½“ï¼ˆå¤šä¸ªï¼‰
                const mitochondriaGroup = new THREE.Group();
                for (let i = 0; i < 5; i++) {
                    const mitochondrionGeometry = new THREE.SphereGeometry(0.8, 16, 16);
                    const mitochondrionMaterial = new THREE.MeshPhongMaterial({ color: 0x00aa77 });
                    const mitochondrion = new THREE.Mesh(mitochondrionGeometry, mitochondrionMaterial);
                    
                    // éšæœºåˆ†å¸ƒåœ¨ç»†èƒè´¨ä¸­
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    const radius = 5 + 2 * Math.random();
                    
                    mitochondrion.position.set(
                        radius * Math.sin(phi) * Math.cos(theta),
                        radius * Math.sin(phi) * Math.sin(theta),
                        radius * Math.cos(phi)
                    );
                    
                    // æ·»åŠ å†…è†œè¤¶çš±æ•ˆæœ
                    const innerMembraneGeometry = new THREE.TorusGeometry(0.6, 0.1, 8, 16);
                    const innerMembraneMaterial = new THREE.MeshPhongMaterial({ color: 0x007755 });
                    
                    for (let j = 0; j < 5; j++) {
                        const innerMembrane = new THREE.Mesh(innerMembraneGeometry, innerMembraneMaterial);
                        innerMembrane.rotation.x = Math.random() * Math.PI;
                        innerMembrane.rotation.y = Math.random() * Math.PI;
                        innerMembrane.position.set(
                            (Math.random() - 0.5) * 0.4,
                            (Math.random() - 0.5) * 0.4,
                            (Math.random() - 0.5) * 0.4
                        );
                        mitochondrion.add(innerMembrane);
                    }
                    
                    mitochondriaGroup.add(mitochondrion);
                }
                group.add(mitochondriaGroup);
                cellParts.eukaryotic.mitochondria = mitochondriaGroup;
                
                // å†…è´¨ç½‘ï¼ˆç²—ç³™å’Œå…‰æ»‘ï¼‰
                const erGroup = new THREE.Group();
                
                // ç²—ç³™å†…è´¨ç½‘ï¼ˆå¸¦æ ¸ç³–ä½“ï¼‰
                const roughErGeometry = new THREE.TorusKnotGeometry(2, 0.3, 100, 16);
                const roughErMaterial = new THREE.MeshPhongMaterial({ color: 0x5555ff });
                const roughEr = new THREE.Mesh(roughErGeometry, roughErMaterial);
                roughEr.position.set(3, 2, 0);
                roughEr.rotation.set(Math.PI/4, Math.PI/4, 0);
                erGroup.add(roughEr);
                
                // æ·»åŠ æ ¸ç³–ä½“åˆ°ç²—ç³™å†…è´¨ç½‘
                for (let i = 0; i < 20; i++) {
                    const ribosomeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                    const ribosomeMaterial = new THREE.MeshPhongMaterial({ color: 0x555555 });
                    const ribosome = new THREE.Mesh(ribosomeGeometry, ribosomeMaterial);
                    
                    // éšæœºåˆ†å¸ƒåœ¨ç²—ç³™å†…è´¨ç½‘å‘¨å›´
                    const angle = (i / 20) * Math.PI * 2;
                    const radius = 2.5 + Math.random() * 0.5;
                    ribosome.position.set(
                        3 + radius * Math.cos(angle),
                        2 + radius * Math.sin(angle),
                        (Math.random() - 0.5) * 1
                    );
                    
                    erGroup.add(ribosome);
                }
                
                // å…‰æ»‘å†…è´¨ç½‘
                const smoothErGeometry = new THREE.TorusKnotGeometry(1.8, 0.3, 100, 16);
                const smoothErMaterial = new THREE.MeshPhongMaterial({ color: 0x8888ff });
                const smoothEr = new THREE.Mesh(smoothErGeometry, smoothErMaterial);
                smoothEr.position.set(-2, -1, 2);
                smoothEr.rotation.set(Math.PI/3, Math.PI/3, 0);
                erGroup.add(smoothEr);
                
                group.add(erGroup);
                cellParts.eukaryotic.endoplasmicReticulum = erGroup;
                
                // é«˜å°”åŸºä½“
                const golgiGroup = new THREE.Group();
                
                // é«˜å°”åŸºä½“ç”±å¤šä¸ªæ‰å¹³çš„å›Šæ³¡ç»„æˆ
                for (let i = 0; i < 5; i++) {
                    const golgiCisternaGeometry = new THREE.TorusGeometry(1.5 - i * 0.2, 0.3, 8, 16);
                    const golgiCisternaMaterial = new THREE.MeshPhongMaterial({ color: 0xffaa00 });
                    const golgiCisterna = new THREE.Mesh(golgiCisternaGeometry, golgiCisternaMaterial);
                    golgiCisterna.position.set(-3, 3, 0);
                    golgiCisterna.rotation.x = Math.PI / 2;
                    golgiCisterna.rotation.z = i * 0.1;
                    golgiGroup.add(golgiCisterna);
                }
                
                group.add(golgiGroup);
                cellParts.eukaryotic.golgiApparatus = golgiGroup;
                
                // æº¶é…¶ä½“
                const lysosomeGeometry = new THREE.SphereGeometry(0.7, 16, 16);
                const lysosomeMaterial = new THREE.MeshPhongMaterial({ color: 0xff5555 });
                const lysosome = new THREE.Mesh(lysosomeGeometry, lysosomeMaterial);
                lysosome.position.set(2, -3, 1);
                group.add(lysosome);
                cellParts.eukaryotic.lysosomes = lysosome;
                
                // æ ¸ç³–ä½“ï¼ˆæ¸¸ç¦»åœ¨ç»†èƒè´¨ä¸­çš„ï¼‰
                const ribosomesGroup = new THREE.Group();
                for (let i = 0; i < 50; i++) {
                    const ribosomeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                    const ribosomeMaterial = new THREE.MeshPhongMaterial({ color: 0x555555 });
                    const ribosome = new THREE.Mesh(ribosomeGeometry, ribosomeMaterial);
                    
                    // éšæœºåˆ†å¸ƒåœ¨ç»†èƒè´¨ä¸­ï¼Œé¿å¼€ç»†èƒæ ¸åŒºåŸŸ
                    let position;
                    do {
                        const theta = Math.random() * Math.PI * 2;
                        const phi = Math.random() * Math.PI;
                        const radius = 6 * Math.random();
                        
                        position = new THREE.Vector3(
                            radius * Math.sin(phi) * Math.cos(theta),
                            radius * Math.sin(phi) * Math.sin(theta),
                            radius * Math.cos(phi)
                        );
                    } while (position.length() < 3); // ç¡®ä¿ä¸åœ¨ç»†èƒæ ¸å†…
                    
                    ribosome.position.copy(position);
                    ribosomesGroup.add(ribosome);
                }
                group.add(ribosomesGroup);
                cellParts.eukaryotic.ribosomes = ribosomesGroup;
                
                return group;
            }
            
            // BioDigital APIé›†æˆåŠŸèƒ½ - å®˜æ–¹æ¨èæ–¹å¼
            function setupBioDigitalModel() {
                console.log('ğŸ§¬ å¼€å§‹è®¾ç½®BioDigital HumanAPIæ¨¡å‹ï¼ˆå®˜æ–¹æ–¹å¼ï¼‰');
                // è¿™ä¸ªå‡½æ•°ç°åœ¨ç”±ä¸»åˆå§‹åŒ–ä»£ç ä¸­çš„iframeæ–¹å¼æ›¿ä»£
                // å‚è€ƒï¼šhttps://developer.biodigital.com/documentation/
            }
            
            // ä½¿å…ƒç´ å¯æ‹–æ‹½
            function makeDraggable(element) {
                let isDragging = false;
                let startX, startY, initialX, initialY;
                
                const title = element.querySelector('div');
                title.style.cursor = 'move';
                
                title.addEventListener('mousedown', function(e) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    const rect = element.getBoundingClientRect();
                    initialX = rect.left;
                    initialY = rect.top;
                    element.style.transition = 'none';
                });
                
                document.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    element.style.left = (initialX + deltaX) + 'px';
                    element.style.top = (initialY + deltaY) + 'px';
                    element.style.right = 'auto';
                });
                
                document.addEventListener('mouseup', function() {
                    if (isDragging) {
                        isDragging = false;
                        element.style.transition = 'all 0.3s ease';
                    }
                });
            }
            
            // ç®€åŒ–çš„æµ‹è¯•å‡½æ•°ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
            window.testBioDigitalAPI = function() {
                console.log('ğŸ§ª æµ‹è¯•BioDigital HumanAPIè¿æ¥...');
                
                if (typeof HumanAPI === 'undefined') {
                    console.log('âŒ BioDigital HumanAPIè„šæœ¬æœªåŠ è½½ï¼');
                    return;
                }
                
                if (window.humanAPI) {
                    try {
                        window.humanAPI.send("timeline.pause");
                        console.log('âœ… BioDigital HumanAPIå·¥ä½œæ­£å¸¸ï¼');
                    } catch (error) {
                        console.log('âŒ HumanAPIå‘½ä»¤å¤±è´¥: ' + error.message);
                    }
                } else {
                    console.log('âš ï¸ HumanAPIå°šæœªåˆå§‹åŒ–ï¼Œè¯·ç­‰å¾…iframeåŠ è½½å®Œæˆ');
                }
            };
            

            
            // åŠ¨é‡æ§åˆ¶
            let velocity = new THREE.Vector3();
            let direction = new THREE.Vector3();
            let targetRotation = new THREE.Vector3();
            let targetPosition = new THREE.Vector3();
            let isMoving = false;
            
            // æ›´æ–°æ§åˆ¶å™¨
            function updateControls() {
                const delta = 0.1; // æ§åˆ¶ç§»åŠ¨å’Œæ—‹è½¬çš„é€Ÿåº¦å› å­
                
                // è®¡ç®—ç›®æ ‡æ—‹è½¬
                targetRotation.x = camera.position.y * 0.1;
                targetRotation.y = camera.position.x * 0.1;
                
                // è®¡ç®—ç›®æ ‡ä½ç½®
                targetPosition.x = Math.sin(Date.now() * 0.001) * 10;
                targetPosition.z = Math.cos(Date.now() * 0.001) * 10;
                
                // æ›´æ–°ç›¸æœºä½ç½®å’Œæ—‹è½¬
                camera.position.lerp(targetPosition, delta);
                camera.rotation.x += (targetRotation.x - camera.rotation.x) * delta;
                camera.rotation.y += (targetRotation.y - camera.rotation.y) * delta;
                
                camera.lookAt(0, 0, 0);
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animate() {
                requestAnimationFrame(animate);
                
                // å®Œå…¨ç§»é™¤è‡ªåŠ¨æ—‹è½¬å’Œè‡ªåŠ¨ç§»åŠ¨ - åªå…è®¸ç”¨æˆ·æ‰‹åŠ¨æ§åˆ¶
                // cells.prokaryotic.rotation.y += 0.002;
                // cells.eukaryotic.rotation.y += 0.001;
                
                // æ›´æ–°æ ‡ç­¾ä½ç½®
                prokaryoticLabel.position.copy(cells.prokaryotic.position);
                prokaryoticLabel.position.y += 12;
                
                eukaryoticLabel.position.copy(cells.eukaryotic.position);
                eukaryoticLabel.position.y += 12;
                
                // ä¸å†è°ƒç”¨updateControls() - å®Œå…¨ç¦ç”¨è‡ªåŠ¨ç›¸æœºç§»åŠ¨
                // updateControls();
                
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆåçš„å¤„ç†ï¼ˆç§»é™¤äº†éƒ¨ç½²æŒ‡å¯¼ï¼‰
        window.addEventListener('load', () => {
            console.log('âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œè·³è¿‡éƒ¨ç½²æŒ‡å¯¼æç¤º');
        });
    </script>
</body>
</html>